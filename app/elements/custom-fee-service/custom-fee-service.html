
<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<link rel="import" href="..\..\bower_components/iron-ajax/iron-ajax.html">

<dom-module id="custom-fee-service">
  <template>
    <!-- It would insert the cash fee -->
     <iron-ajax
        method="post"
        id="insertcashfeesajax"
        url="{{insertcashfeesurl}}"
        params="{{insertcashfeesparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="insertcashfeesResponse"
        debounce-duration="300"
        >
    <!-- It would insert the TP fee -->
     <iron-ajax
        method="post"
        id="Thirdpartyfeesajax"
        url="{{Thirdpartyfeesurl}}"
        params="{{Thirdpartyfeesparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="ThirdpartyfeesResponse"
        debounce-duration="300"
        >
      <!-- It would insert the cheque fee -->
     <iron-ajax
        method="post"
        id="insertchequefeesajax"
        url="{{insertchequefeesurl}}"
        params="{{insertchequefeesparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="insertchequefeesResponse"
        debounce-duration="300"
        >
    <!-- It would insert the transfer fee -->
     <iron-ajax
        method="post"
        id="inserttransferfeesajax"
        url="{{inserttransferfeesurl}}"
        params="{{inserttransferfeesparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="inserttransferfeesResponse"
        debounce-duration="300"
        >
    <!-- It would fetch installment fee splitip -->
     <iron-ajax
        method="post"
        id="fetchInstallmentseperationajax"
        url="{{fetchInstallmentseperationurl}}"
        params="{{fetchInstallmentseperationparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchInstallmentseperationResponse"
        debounce-duration="300"
        > 

     <!-- It would insert installment fee splitip for each student-->
     <iron-ajax
        method="post"
        id="insertinstallmentsplitofstudajax"
        url="{{insertinstallmentsplitofstudurl}}"
        params="{{insertinstallmentsplitofstudparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="insertinstallmentsplitofstudResponse"
        debounce-duration="300"
        >  

    <!-- It would insert installment fee splitip for each student-->
     <iron-ajax
        method="post"
        id="fetchstudinstallmentsplitupajax"
        url="{{fetchstudinstallmentsplitupurl}}"
        params="{{fetchstudinstallmentsplitupparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchstudinstallmentsplitupResponse"
        debounce-duration="300"
        > 

     <iron-ajax
        method="post"
        id="insertstudwisefeesplitupajax"
        url="{{insertstudwisefeesplitupurl}}"
        params="{{insertstudwisefeesplitupparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="insertstudwisefeesplitupResponse"
        debounce-duration="300"
        >
        
  </template>
  <script>
  (function() {
    'use strict';
    var paymentarr=[];
    var paymentlength=0;
    var paymentcount=0;
    var cash=[];
    var cheque=[];
    var transfer=[];
    var thirdparty=[];
    var feethirdpartycount=0;
    var feecashcount=0;
    var feechequecount=0;
    var feetransfercount=0;
    var feereceiptarr=[];
    var arr=[];
    var studsplitarr=[];
    Polymer({
      is: 'custom-fee-service',

      callInsertCashfeesService:function(arr,len){
        // alert(len);
        paymentlength=len;
        cash.push(arr);
        this.insertcashfeesurl=sessionStorage.getItem("addrinfo")+"/insertcashfees";
        var obj={"schoolid":"","academicyear":"","enquiryno":"","admissionno":"","studentname":"","garde":"","feetype":"","feecode":"","installmenttype":"","installment":"","installmentdate":"","installmentamount":"","waiveoffamount":"","modeofpayment":"","receiptdate":"","paiddate":"","paidstatus":"","cratedon":"","createdby":"","updatedon":"","updatedby":""}        
        // alert(JSON.stringify(arr));        
        obj.schoolid=localStorage.getItem("schoolid"); 
        obj.academicyear=localStorage.getItem("curr_sess_academicyear"); 
        // obj.enquiryno=localStorage.getItem("curr_sess_enquiryno"); 
        obj.admissionno=localStorage.getItem("curr_sess_enquiryno"); 
        obj.studentname=localStorage.getItem("curr_sess_studentname"); 
        obj.grade=localStorage.getItem("curr_sess_grade"); 
        // obj.feetype=localStorage.getItem("curr_sess_feetype"); 
        obj.feecode=localStorage.getItem("curr_sess_feecode");

        for(var i=0;i<cash.length;i++){
        obj.installmenttype=cash[i].installmenttype; 
        obj.installment=cash[i].installment; 
        obj.installmentdate=cash[i].installmentdate; 
        obj.installmentamount=cash[i].amount;
        obj.actualamount=cash[i].actualamount;
        obj.discountamount=cash[i].discountamount; 
        obj.waiveoffamount=cash[i].waiveoff; 
        obj.modeofpayment=cash[i].paymentmode; 
        obj.receiptdate=cash[i].receiptdate; 
        obj.paiddate=cash[i].paiddate; 
        obj.paidstatus=cash[i].paidstatus;   
        obj.feecashcount=feecashcount;
        obj.fineamount=0; 
        obj.receiveddate=localStorage.getItem("curr_sess_date"); 
        obj.paymentthrough=localStorage.getItem("curr_sess_paymentthrough");
        obj.installmentpattern=localStorage.getItem("curr_sess_installmentpattern");   
        obj.createdby=localStorage.getItem("employeeid"); 
        obj.provisionflag=localStorage.getItem("curr_sess_provisionflag");  
        obj.adhocdiscount=localStorage.getItem("curr_sess_adhocdiscount");
        obj.adhocfeetype=localStorage.getItem("curr_sess_adhocfeetype");
        obj.adhocreason=localStorage.getItem("curr_sess_adhocreason");
        obj.type=localStorage.getItem("curr_sess_feetypepaymentflag");
        obj.admissionstatus=localStorage.getItem("curr_sess_admissionstatus");

        this.insertcashfeesparam=obj;   
        // paymentarr.push(obj);            
        this.$.insertcashfeesajax.generateRequest();
        cash=[];
        }
        
        feecashcount++;
      },
      insertcashfeesResponse:function(e){
          // alert(e.detail.response.returnval);
          if(e.detail.response.returnval=="Fee paid!"){
            e.detail.response.info.receipt_no=e.detail.response.receiptno;
            e.detail.response.info.receiptdatee=e.detail.response.receiptdate;
            e.detail.response.info.receipttype="RECEIPT";
            e.detail.response.info.hidereceipt=false;
            e.detail.response.info.hideack=true;
            e.detail.response.info.chequeview=true;
            e.detail.response.info.transferview=true;
            paymentarr.push(e.detail.response.info);
            paymentcount++;            
            if(paymentlength==paymentcount)
                this.fetchInstallmentseperationService();
                // this.fetchstudinstallmentsplitup();
                // this.fetchInstallmentseperationService();
                // this.callFeeReceipt();
            // document.querySelector('feereceipt-card').setValue(paymentarr,e.detail.response.receiptno);
          }

      },
      callInsertThirdpartyfeesService:function(arr,len){
        // alert(len);
        paymentlength=len;
        thirdparty.push(arr);
        
        this.Thirdpartyfeesurl=sessionStorage.getItem("addrinfo")+"/insertthirdpartyfees";

        var obj={"schoolid":"","academicyear":"","enquiryno":"","admissionno":"","studentname":"","garde":"","feetype":"","feecode":"","installmenttype":"","installment":"","installmentdate":"","installmentamount":"","waiveoffamount":"","modeofpayment":"","receiptdate":"","paiddate":"","paidstatus":"","cratedon":"","createdby":"","updatedon":"","updatedby":""}        
        // alert(JSON.stringify(arr));        

        obj.schoolid=localStorage.getItem("schoolid"); 
        obj.academicyear=localStorage.getItem("curr_sess_academicyear"); 
        // obj.enquiryno=localStorage.getItem("curr_sess_enquiryno"); 
        obj.admissionno=localStorage.getItem("curr_sess_enquiryno"); 
        obj.studentname=localStorage.getItem("curr_sess_studentname"); 
        obj.grade=localStorage.getItem("curr_sess_grade"); 
        // obj.feetype=localStorage.getItem("curr_sess_feetype"); 
        obj.feecode=localStorage.getItem("curr_sess_feecode");

        for(var i=0;i<thirdparty.length;i++){
        obj.installmenttype=thirdparty[i].installmenttype; 
        obj.installment=thirdparty[i].installment; 
        obj.installmentdate=thirdparty[i].installmentdate; 
        obj.installmentamount=thirdparty[i].amount;
        obj.actualamount=thirdparty[i].actualamount;
        obj.discountamount=thirdparty[i].discountamount; 
        obj.waiveoffamount=thirdparty[i].waiveoff; 
        obj.modeofpayment=thirdparty[i].paymentmode; 
        obj.receiptdate=thirdparty[i].receiptdate; 
        obj.paiddate=thirdparty[i].paiddate; 
        obj.paidstatus=thirdparty[i].paidstatus;   
        obj.feethirdpartycount=feethirdpartycount;
        obj.fineamount=0;
        obj.receiveddate=localStorage.getItem("curr_sess_date");  
        obj.paymentthrough=localStorage.getItem("curr_sess_paymentthrough");  
        obj.installmentpattern=localStorage.getItem("curr_sess_installmentpattern");
        obj.createdby=localStorage.getItem("employeeid"); 
        obj.provisionflag=localStorage.getItem("curr_sess_provisionflag");
        obj.adhocdiscount=localStorage.getItem("curr_sess_adhocdiscount");
        obj.adhocfeetype=localStorage.getItem("curr_sess_adhocfeetype");
        obj.adhocreason=localStorage.getItem("curr_sess_adhocreason");
        obj.type=localStorage.getItem("curr_sess_feetypepaymentflag");   
        obj.admissionstatus=localStorage.getItem("curr_sess_admissionstatus");
        this.Thirdpartyfeesparam=obj;   

        // paymentarr.push(obj);            
        this.$.Thirdpartyfeesajax.generateRequest();
        thirdparty=[];
        }        
        feethirdpartycount++;
      },
      ThirdpartyfeesResponse:function(e){
          // alert(e.detail.response.returnval);
          if(e.detail.response.returnval=="Fee paid!"){
            e.detail.response.info.receipt_no=e.detail.response.receiptno;
            e.detail.response.info.receiptdatee=e.detail.response.receiptdate;
            e.detail.response.info.receipttype="ACKNOWLEDGEMENT";
            e.detail.response.info.hidereceipt=false;
            e.detail.response.info.hideack=true;
            e.detail.response.info.chequeview=true;
            e.detail.response.info.transferview=false;
            paymentarr.push(e.detail.response.info);
            paymentcount++;
            if(paymentlength==paymentcount)
                this.fetchInstallmentseperationService();
                // this.fetchstudinstallmentsplitup();
          }
      },
      callInsertChequefeesService:function(arr,len){
        // alert(feechequecount);
        paymentlength=len;
        cheque.push(arr);
        
        this.insertchequefeesurl=sessionStorage.getItem("addrinfo")+"/insertchequefees";
        var obj={"schoolid":"","academicyear":"","enquiryno":"","admissionno":"","studentname":"","garde":"","feetype":"","feecode":"","installmenttype":"","installment":"","installmentdate":"","installmentamount":"","waiveoffamount":"","modeofpayment":"","receiptdate":"","paiddate":"","paidstatus":"","cratedon":"","createdby":"","updatedon":"","updatedby":""}

        obj.schoolid=localStorage.getItem("schoolid"); 
        obj.academicyear=localStorage.getItem("curr_sess_academicyear"); 
        // obj.enquiryno=localStorage.getItem("curr_sess_enquiryno"); 
        obj.admissionno=localStorage.getItem("curr_sess_enquiryno"); 
        obj.studentname=localStorage.getItem("curr_sess_studentname"); 
        obj.grade=localStorage.getItem("curr_sess_grade"); 
        // obj.feetype=localStorage.getItem("curr_sess_feetype"); 
        obj.feecode=localStorage.getItem("curr_sess_feecode");
 
        for(var i=0;i<cheque.length;i++){ 
        obj.installmenttype=cheque[i].installmenttype; 
        obj.installment=cheque[i].installment; 
        obj.installmentdate=cheque[i].installmentdate; 
        obj.installmentamount=cheque[i].amount; 
        obj.actualamount=cheque[i].actualamount;
        obj.discountamount=cheque[i].discountamount; 
        obj.waiveoffamount=cheque[i].waiveoff; 
        obj.modeofpayment=cheque[i].paymentmode; 
        obj.receiveddate=cheque[i].receiveddate;       
        obj.paidstatus=cheque[i].paidstatus; 
        obj.chequeno=cheque[i].chequeno;        
        obj.bankname=cheque[i].bankname; 
        obj.chequedate=cheque[i].chequedate; 
        obj.chequestatus=cheque[i].chequestatus; 
        obj.feechequecount=feechequecount;
        obj.fineamount=0; 
        obj.receiveddate=localStorage.getItem("curr_sess_date");
        obj.paymentthrough=localStorage.getItem("curr_sess_paymentthrough");
        obj.installmentpattern=localStorage.getItem("curr_sess_installmentpattern");  
        obj.createdby=localStorage.getItem("employeeid"); 
        obj.provisionflag=localStorage.getItem("curr_sess_provisionflag");   
        obj.adhocdiscount=localStorage.getItem("curr_sess_adhocdiscount");
        obj.adhocfeetype=localStorage.getItem("curr_sess_adhocfeetype");
        obj.adhocreason=localStorage.getItem("curr_sess_adhocreason");
        obj.type=localStorage.getItem("curr_sess_feetypepaymentflag");
        obj.admissionstatus=localStorage.getItem("curr_sess_admissionstatus");
        obj.receiptdate=cheque[i].receiptdate;     
        this.insertchequefeesparam=obj; 
        // alert(JSON.stringify(obj)); 
        // paymentarr.push(obj);     
        this.$.insertchequefeesajax.generateRequest();
        cheque=[];
        }
        feechequecount++;

      },
      insertchequefeesResponse:function(e){
          // alert(e.detail.response.returnval);
          if(e.detail.response.returnval=="Fee paid!"){
            e.detail.response.info.ack_no=e.detail.response.receiptno;
            e.detail.response.info.receiptdatee=e.detail.response.receiptdate;
            e.detail.response.info.receipttype="ACKNOWLEDGEMENT";
            e.detail.response.info.hidereceipt=true;
            e.detail.response.info.hideack=false;
            e.detail.response.info.chequeview=false;
            e.detail.response.info.transferview=true;
            paymentarr.push(e.detail.response.info);
            paymentcount++;
            if(paymentlength==paymentcount){
                this.fetchInstallmentseperationService();
                // this.fetchstudinstallmentsplitup();
                // this.fetchInstallmentseperationService();
                // this.callFeeReceipt();
            }
            // document.querySelector('feereceipt-card').setValue(paymentarr,e.detail.response.receiptno);
          }
      },
      callInsertTransferfeesService:function(arr,len){
        // alert(feetransfercount);
        paymentlength=len;
        transfer.push(arr);
        
        this.inserttransferfeesurl=sessionStorage.getItem("addrinfo")+"/inserttransferfees";
        var obj={"schoolid":"","academicyear":"","enquiryno":"","admissionno":"","studentname":"","garde":"","feetype":"","feecode":"","installmenttype":"","installment":"","installmentdate":"","installmentamount":"","waiveoffamount":"","modeofpayment":"","receiptdate":"","paiddate":"","paidstatus":"","cratedon":"","createdby":"","updatedon":"","updatedby":""}

        obj.schoolid=localStorage.getItem("schoolid"); 
        obj.academicyear=localStorage.getItem("curr_sess_academicyear"); 
        // obj.enquiryno=localStorage.getItem("curr_sess_enquiryno"); 
        obj.admissionno=localStorage.getItem("curr_sess_enquiryno"); 
        obj.studentname=localStorage.getItem("curr_sess_studentname"); 
        obj.grade=localStorage.getItem("curr_sess_grade"); 
        // obj.feetype=localStorage.getItem("curr_sess_feetype"); 
        obj.feecode=localStorage.getItem("curr_sess_feecode");
        for(var i=0;i<transfer.length;i++){ 
        obj.installmenttype=transfer[i].installmenttype; 
        obj.installment=transfer[i].installment; 
        obj.installmentdate=transfer[i].installmentdate; 
        obj.installmentamount=transfer[i].amount; 
        obj.actualamount=transfer[i].actualamount;
        obj.discountamount=transfer[i].discountamount; 
        obj.waiveoffamount=transfer[i].waiveoff; 
        obj.modeofpayment=transfer[i].paymentmode; 
        obj.receiveddate=transfer[i].receiveddate; 
        obj.paiddate=transfer[i].paiddate; 
        obj.paidstatus=transfer[i].paidstatus; 
        obj.referenceno=transfer[i].referenceno;        
        obj.bankname=transfer[i].bankname; 
        obj.chequedate=transfer[i].chequedate;
        obj.feetransfercount=feetransfercount; 
        obj.fineamount=0; 
        obj.receiveddate=localStorage.getItem("curr_sess_date");        
        obj.paymentthrough=localStorage.getItem("curr_sess_paymentthrough");
        obj.installmentpattern=localStorage.getItem("curr_sess_installmentpattern");
        obj.createdby=localStorage.getItem("employeeid"); 
        obj.provisionflag=localStorage.getItem("curr_sess_provisionflag");   
        obj.adhocdiscount=localStorage.getItem("curr_sess_adhocdiscount");
        obj.adhocfeetype=localStorage.getItem("curr_sess_adhocfeetype");
        obj.adhocreason=localStorage.getItem("curr_sess_adhocreason");
        obj.type=localStorage.getItem("curr_sess_feetypepaymentflag");
        obj.admissionstatus=localStorage.getItem("curr_sess_admissionstatus");
        obj.receiptdate=transfer[i].receiptdate;     
        this.inserttransferfeesparam=obj; 
        // paymentarr.push(obj);   
        this.$.inserttransferfeesajax.generateRequest();
        transfer=[];
        }
        feetransfercount++;
        
      },
      inserttransferfeesResponse:function(e){
          // alert(e.detail.response.returnval);
          if(e.detail.response.returnval=="Fee paid!"){
            e.detail.response.info.receipt_no=e.detail.response.receiptno;
            e.detail.response.info.receiptdatee=e.detail.response.receiptdate;
            e.detail.response.info.receipttype="ACKNOWLEDGEMENT";
            e.detail.response.info.hidereceipt=false;
            e.detail.response.info.hideack=true;
            e.detail.response.info.chequeview=true;
            e.detail.response.info.transferview=false;
            paymentarr.push(e.detail.response.info);
            paymentcount++;
            if(paymentlength==paymentcount)
                this.fetchInstallmentseperationService();
                // this.fetchstudinstallmentsplitup();
                // this.fetchInstallmentseperationService();
                // this.callFeeReceipt();
            // document.querySelector('feereceipt-card').setValue(paymentarr,e.detail.response.receiptno);
          }
      },
      fetchstudinstallmentsplitup:function(){
        this.fetchstudinstallmentsplitupurl=sessionStorage.getItem("addrinfo")+"/fetchstudinstallmentsplitup";
        var obj={};
        obj.schoolid=localStorage.getItem("schoolid"); 
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.admissionno=localStorage.getItem("curr_sess_enquiryno");
        this.fetchstudinstallmentsplitupparam=obj;              
        this.$.fetchstudinstallmentsplitupajax.generateRequest();
      },
      fetchstudinstallmentsplitupResponse:function(e){
        this.studinssplit=e.detail.response.returnval;

        var a=[];
        var split=[];
        var temp=[];
        // alert(localStorage.getItem("curr_sess_installmentpattern"));
        if(localStorage.getItem("curr_sess_feetypepayment")=='Application fee'||localStorage.getItem("curr_sess_feetypepayment")=='Registration fee'){}
            else{
        if(localStorage.getItem("curr_sess_installmentpattern")=="1"){
        for(var i=0;i<this.studinssplit.length;i++)
       {       
        var nameobj={"installment":"","installmentamount":""};
        nameobj.installmentid=this.studinssplit[i].installment;
        nameobj.installment=this.studinssplit[i].installment; 
        nameobj.installmentdate=this.studinssplit[i].installmentdate;
        var amt=0;
        var actamt=0;
        var obj={"feetype":"","amount":""};
        obj.feetype=this.studinssplit[i].feetype;
        obj.feetypeamount=this.studinssplit[i].feetype_amount;
        obj.feetypeactualamount=this.studinssplit[i].feetype_actual_amount;
        if(this.studinssplit[i].feetype_amount>0)
        a.push(obj);
        for(var j=i+1;j<this.studinssplit.length;j++)
        {
           // alert(termarr[i].insno+" "+termarr[j].insno);
           if(this.studinssplit[i].installment==this.studinssplit[j].installment)
           {
             var obj1={"feetype":"","amount":""}
             obj1.feetype=this.studinssplit[j].feetype;
             obj1.feetypeamount=this.studinssplit[j].feetype_amount;
             obj1.feetypeactualamount=this.studinssplit[j].feetype_actual_amount;
             if(this.studinssplit[j].feetype_amount>0)
             a.push(obj1);
             this.studinssplit.splice(j,1);
             j--;
           }
        }
        nameobj.installmentamount=this.studinssplit[i].installment_amount;
        nameobj.actualamount=this.studinssplit[i].actual_amount;
        nameobj.discountamount=this.studinssplit[i].discount_amount;;
        nameobj.fees=a;
        // alert(JSON.stringify(nameobj));
        split.push(nameobj);
        // split.push(temp);
        // temp=[];
        a=[];        
       }
      }
      else if(localStorage.getItem("curr_sess_installmentpattern")=="3")
      {
        
            var amt=0;
            var actamt=0;
            // alert(JSON.stringify(this.studinssplit));
            for(var i=0;i<this.studinssplit.length;i++){
              var obj={"feetype":"","feetypeamount":""};
              var f=0;
              if(split.length==0){
              obj.feetype=this.studinssplit[i].feetype;
              obj.feetypeamount=this.studinssplit[i].feetype_actual_amount;
              if(obj.feetypeamount>0)
              split.push(obj);
              // alert(JSON.stringify(obj));
              } 
              else{
              for(var j=0;j<split.length;j++){              
              // alert(this.studinssplit[i].feetype+" "+split[j].feetype);
              if((this.studinssplit[i].feetype).trim()==(split[j].feetype).trim()){
                // alert('come');
              f=1;
              obj.feetypeamount=parseFloat(this.studinssplit[i].feetype_actual_amount)+parseFloat(split[j].feetypeamount);
              split[j].feetypeamount=obj.feetypeamount;
              }
              }
              if(f==0)
              {
              obj.feetype=this.studinssplit[i].feetype;
              obj.feetypeamount=this.studinssplit[i].feetype_actual_amount;
              // alert(JSON.stringify(obj));
              if(obj.feetypeamount>0)
              split.push(obj);
              }
              }                           
            }

            // alert(localStorage.getItem("curr_sess_discountfeetype"));
            // alert(JSON.stringify(split));
            // alert(localStorage.getItem("curr_sess_discountpercentamt"));
            // alert(localStorage.getItem("curr_sess_payablediscount"));
            this.flag=0;
            this.remainingdiscount=0;
            for(var i=0;i<split.length;i++){
                // if(localStorage.getItem("curr_sess_discountpercentamt")>0)
                // {
                    if(split[i].feetype==localStorage.getItem("curr_sess_discountfeetype")){
                       if(parseFloat(split[i].feetypeamount)>=parseFloat(localStorage.getItem("curr_sess_payablediscount"))) 
                       {
                       this.flag=1;
                       split[i].feetypeamount=parseFloat(split[i].feetypeamount)-parseFloat(localStorage.getItem("curr_sess_payablediscount"));
                       }
                       else{                       
                       this.remainingdiscount=parseFloat(localStorage.getItem("curr_sess_payablediscount"))-parseFloat(split[i].feetypeamount);
                       split[i].feetypeamount=0;
                       }
                    }
                // }
            }

            if(this.flag==0){
                for(var i=0;i<split.length;i++){
                    if(split[i].feetype=="Tution fee"){
                        if(parseFloat(this.remainingdiscount)>0){
                            split[i].feetypeamount=parseFloat(split[i].feetypeamount)-parseFloat(this.remainingdiscount);
                        }
                    }
                }
            }


                // if(localStorage.getItem("curr_sess_payablediscount")>0)
                // {
                //     if(split[i].feetype=="Annual fee"){
                //        split[i].feetypeamount=parseFloat(split[i].feetypeamount)-parseFloat(localStorage.getItem("curr_sess_payablediscount"));
                //     }
                // }
            
            // alert(JSON.stringify(split));
      }
      else if(localStorage.getItem("curr_sess_installmentpattern")=="4")
      {
        for(var i=0;i<this.studinssplit.length;i++)
       {       
        var nameobj={"installment":"","installmentamount":""};
        nameobj.installmentid=this.studinssplit[i].installment;
        nameobj.installment=this.studinssplit[i].installment; 
        nameobj.installmentdate=this.studinssplit[i].installmentdate;
        var amt=0;
        var actamt=0;
        var obj={"feetype":"","amount":""};
        obj.feetype=this.studinssplit[i].feetype;
        obj.feetypeamount=this.studinssplit[i].feetype_amount;
        obj.feetypeactualamount=this.studinssplit[i].feetype_actual_amount;
        if(this.studinssplit[i].feetype_amount>0)
        a.push(obj);
        for(var j=i+1;j<this.studinssplit.length;j++)
        {
           // alert(termarr[i].insno+" "+termarr[j].insno);
           if(this.studinssplit[i].installment==this.studinssplit[j].installment)
           {
             var obj1={"feetype":"","amount":""}
             obj1.feetype=this.studinssplit[j].feetype;
             obj1.feetypeamount=this.studinssplit[j].feetype_amount;
             obj1.feetypeactualamount=this.studinssplit[j].feetype_actual_amount;
             if(this.studinssplit[j].feetype_amount>0)
             a.push(obj1);
             this.studinssplit.splice(j,1);
             j--;
           }
        }
        nameobj.installmentamount=this.studinssplit[i].installment_amount;
        nameobj.actualamount=this.studinssplit[i].actual_amount;
        nameobj.discountamount=this.studinssplit[i].discount_amount;;
        nameobj.fees=a;
        // alert(JSON.stringify(nameobj));
        split.push(nameobj);
        // split.push(temp);
        // temp=[];
        a=[];        
       }            
      }

     }

       if(localStorage.getItem("curr_sess_installmentpattern")=="1"){
       for(var i=0;i<paymentarr.length;i++){
            for(var j=0;j<split.length;j++){
                if(localStorage.getItem("curr_sess_insrequirement")=="yes"){
                    if((paymentarr[i].installment_type=="Commitment Fee (Ins1)"||paymentarr[i].installment_type=="Commitment Fee (Ins2)")&&split[j].installment=="Commitment Fee"){
                        paymentarr[i].fees=split[j].fees;
                    }
                    else{
                    if(paymentarr[i].installment_type==split[j].installment)
                    {
                    paymentarr[i].fees=split[j].fees;
                    } 
                    }
                }
                else{
                // alert(paymentarr[i].installment_type+"  "+split[j].installment);
                if(paymentarr[i].installment_type==split[j].installment)
                {
                    paymentarr[i].fees=split[j].fees;
                }
                }
            }
        }
      }
      else if(localStorage.getItem("curr_sess_installmentpattern")=="3"){
        paymentarr[0].fees=split;
      }
      else if(localStorage.getItem("curr_sess_installmentpattern")=="4")
      {        
        var x=[];
        for(var i=0;i<split.length;i++){
            // alert(split[i].installment);
            if(split[i].installment!="Commitment Fee"){
              // alert(JSON.stringify(split[i].fees));
              for(var y=0;y<split[i].fees.length;y++){
              var obj={"feetype":"","feetypeamount":""};
              var f=0;
              if(x.length==0){
              obj.feetype=split[i].fees[y].feetype;
              obj.feetypeamount=split[i].fees[y].feetypeactualamount;
              if(obj.feetypeamount>0)
              x.push(obj);
              // alert(JSON.stringify(obj));
              } 
              else{
              for(var j=0;j<x.length;j++){              
              // alert(split[i].fees[y].feetype+" "+x[j].feetype);
              if((split[i].fees[y].feetype).trim()==(x[j].feetype).trim()){
              // alert('come');
              f=1;
              obj.feetypeamount=parseFloat(split[i].fees[y].feetypeactualamount)+parseFloat(x[j].feetypeamount);
              x[j].feetypeamount=obj.feetypeamount;
              }
              }
              if(f==0)
              {
              obj.feetype=split[i].fees[y].feetype;
              obj.feetypeamount=split[i].fees[y].feetypeactualamount;
              // alert(JSON.stringify(obj));
              if(obj.feetypeamount>0)
              x.push(obj);
              }
              }   
              } 
              }                       
            }
            // alert(JSON.stringify(x));
            for(var i=0;i<split.length;i++){
                if(split[i].installment=="Commitment Fee"){
                }
                else if(split[i].installment=="Installment1"){
                    split[i].fees=x;
                }
                else{
                    split.splice(i,1);
                }
            }

       // alert(JSON.stringify(split));
       // alert(localStorage.getItem("curr_sess_discountpercentamt"));
       this.remainingdiscount=0;
       for(var i=0;i<split.length;i++){
                   this.flag=0;
                   if(split[i].installment=="Installment1"){ 
                    for(var j=0;j<split[i].fees.length;j++){
                    if(split[i].fees[j].feetype==localStorage.getItem("curr_sess_discountfeetype")){
                       if(parseFloat(split[i].fees[j].feetypeamount)>=parseFloat(localStorage.getItem("curr_sess_payablediscount"))){
                       this.flag=1;
                       split[i].fees[j].feetypeamount=parseFloat(split[i].fees[j].feetypeamount)-parseFloat(localStorage.getItem("curr_sess_payablediscount"));
                       }
                       else{
                        this.remainingdiscount=parseFloat(localStorage.getItem("curr_sess_payablediscount"))-parseFloat(split[i].fee[j].feetypeamount);
                        split[i].fees[j].feetypeamount=0;
                       }
                    }
                    }
                   }
        }
        if(this.flag==0){
            for(var i=0;i<split.length;i++){
            if(split[i].installment=="Installment1"){ 
                    for(var j=0;j<split[i].fees.length;j++){
                    if(split[i].fees[j].feetype=="Tution fee"){
                       if(parseFloat(this.remainingdiscount>0))
                       split[i].fees[j].feetypeamount=parseFloat(split[i].fees[j].feetypeamount)-parseFloat(this.remainingdiscount); 
                    }
                }
            }
            }
        }
           
        for(var i=0;i<paymentarr.length;i++){
            for(var j=0;j<split.length;j++){
            if(paymentarr[i].installment_type==split[j].installment)
                {
                  paymentarr[i].fees=split[j].fees;
                }
            }
        }
      }
        // alert(JSON.stringify(split));
        this.insertstudwisefeesplitupService(split,paymentarr);
        this.fetchInstallmentseperationService();
        // this.FnFormStructure();
      },
      FnSetSplitarr:function(splitarr){
        arr=splitarr;
      },
      fetchInstallmentseperationService:function(){  

        var splitarr=[];
        var feetype=[];
        for(var i=0;i<arr.length;i++){
            if(arr[i].amount=="0")
                arr.splice(i,1);
        }

        var cashparticular=[];
        var chequeparticular=[];
        var currchequeparticular=[];
        var transferparticular=[];
        var tpparticular=[];
        var cashtotal=0;
        var chequetotal=0;
        var currchequetotal=0;
        var transfertotal=0;
        var tptotal=0; 
        var cashno=1;
        var chequeno=1;
        var currchequeno=1;
        var transferno=1;
        var tpno=1;       
        var cashcnt=0;
        var chequecnt=0;
        var currchequecnt=0;
        var transfercnt=0;
        var tpcnt=0;
        for(var i=0;i<paymentarr.length;i++){
            if(paymentarr[i].mode_of_payment=="Cash"){
                if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null)
            paymentarr[i].latefee_amount=0;
                cashtotal=parseFloat(parseFloat(paymentarr[i].installment_amount)+parseFloat(cashtotal)+parseFloat(paymentarr[i].fine_amount)+parseFloat(paymentarr[i].latefee_amount)).toFixed(2);
                cashparticular.push({"slno":cashno,"installment":paymentarr[i].installment_type,"feetype":paymentarr[i].fees,"installmentamount":paymentarr[i].installment_amount});
                cashno++;
            }
            else if(paymentarr[i].mode_of_payment=="Cheque"){
                if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null)
            paymentarr[i].latefee_amount=0;
                if(paymentarr[i].cheque_date<=paymentarr[i].received_date){
                currchequetotal=parseFloat(parseFloat(paymentarr[i].installment_amount)+parseFloat(currchequetotal)+parseFloat(paymentarr[i].fine_amount)+parseFloat(paymentarr[i].latefee_amount)).toFixed(2);
                currchequeparticular.push({"slno":chequeno,"installment":paymentarr[i].installment_type,"feetype":paymentarr[i].fees,"bankname":paymentarr[i].bank_name,"chequeno":paymentarr[i].cheque_no,"chequedate":paymentarr[i].cheque_date,"installmentamount":paymentarr[i].installment_amount});
                currchequeno++;
                }
                else{
                chequetotal=parseFloat(parseFloat(paymentarr[i].installment_amount)+parseFloat(chequetotal)+parseFloat(paymentarr[i].fine_amount)+parseFloat(paymentarr[i].latefee_amount)).toFixed(2);
                chequeparticular.push({"slno":chequeno,"installment":paymentarr[i].installment_type,"feetype":paymentarr[i].fees,"bankname":paymentarr[i].bank_name,"chequeno":paymentarr[i].cheque_no,"chequedate":paymentarr[i].cheque_date,"installmentamount":paymentarr[i].installment_amount});
                chequeno++;
                }
            }
            else if(paymentarr[i].mode_of_payment=="Transfer"||paymentarr[i].mode_of_payment=="Card Swipe"){
                if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null)
            paymentarr[i].latefee_amount=0;
                transfertotal=parseFloat(parseFloat(paymentarr[i].installment_amount)+parseFloat(transfertotal)+parseFloat(paymentarr[i].fine_amount)+parseFloat(paymentarr[i].latefee_amount)).toFixed(2);
                transferparticular.push({"slno":transferno,"installment":paymentarr[i].installment_type,"feetype":paymentarr[i].fees,"bankname":paymentarr[i].bank_name,"referenceno":paymentarr[i].reference_no,"receiveddate":paymentarr[i].received_date,"installmentamount":paymentarr[i].installment_amount});
                transferno++;
            }
            else if(paymentarr[i].mode_of_payment=="Third Party"){
                if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null)
            paymentarr[i].latefee_amount=0;
                tptotal=parseFloat(parseFloat(paymentarr[i].installment_amount)+parseFloat(tptotal)+parseFloat(paymentarr[i].fine_amount)+parseFloat(paymentarr[i].latefee_amount)).toFixed(2);
                tpparticular.push({"slno":tpno,"installment":paymentarr[i].installment_type,"feetype":paymentarr[i].fees,"installmentamount":paymentarr[i].installment_amount});
                tpno++;
            }
        }
        for(var i=0;i<paymentarr.length;i++){
            if(paymentarr[i].mode_of_payment=="Cash"){
                var obj={"schoolid":"","academicyear":"","admissionno":"","studentname":"","grade":"","installment":"","paiddate":"","receiptno":"","receipttype":"","hidereceipt":"","hideack":"","chequeview":"","transferview":"","paymentarr":""};
                obj.modeofpayment=paymentarr[i].mode_of_payment;
                obj.schoolid=paymentarr[i].school_id;
                obj.academicyear=paymentarr[i].academic_year;
                obj.admissionno=paymentarr[i].admission_no;
                obj.studentname=paymentarr[i].student_name;
                obj.grade=paymentarr[i].grade;
                if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null){
            paymentarr[i].latefee_amount=0;
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=true;
            }

                obj.fineamount=paymentarr[i].fine_amount;
                obj.latefeeamount=paymentarr[i].latefee_amount;
                obj.installment=paymentarr[i].installment;
                obj.installmentamount=paymentarr[i].installment_amount;
                obj.actualamount=paymentarr[i].installment_amount;
                obj.discountamount=paymentarr[i].installment_amount;
                obj.paiddate=paymentarr[i].paid_date;
                obj.receiptno=paymentarr[i].receipt_no;
                obj.receiptdate=paymentarr[i].receiptdatee;
                obj.receipttype=paymentarr[i].receipttype;
                obj.hidereceipt=paymentarr[i].hidereceipt;
                obj.hideack=paymentarr[i].hideack;
                obj.chequeview=paymentarr[i].chequeview;
                obj.transferview=paymentarr[i].transferview;
                obj.paymentarr=cashparticular;
                obj.totalfees=cashtotal;
                obj.hidecashparticular=false;
                obj.hidechequeparticular=true;
                obj.hidetransferparticular=true;
                obj.hidecurrreceipt=true;
                obj.hidelatefeecashparticular=true;
                obj.hidelatefeechequeparticular=true;
                if(obj.installment="Application fee")
                    obj.hidesplit=true;
                if(cashcnt==0)
                    feereceiptarr.push(obj);
                cashcnt++;
            }
            // for(var i=0;i<paymentarr.length;i++){
            if(paymentarr[i].mode_of_payment=="Third Party"){
                var obj={"schoolid":"","academicyear":"","admissionno":"","studentname":"","grade":"","installment":"","paiddate":"","receiptno":"","receipttype":"","hidereceipt":"","hideack":"","chequeview":"","transferview":"","paymentarr":""};
                obj.modeofpayment=paymentarr[i].mode_of_payment;
                obj.schoolid=paymentarr[i].school_id;
                obj.academicyear=paymentarr[i].academic_year;
                obj.admissionno=paymentarr[i].admission_no;
                obj.studentname=paymentarr[i].student_name;
                obj.grade=paymentarr[i].grade;
                if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null){
            paymentarr[i].latefee_amount=0;
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=true;
            }
                obj.fineamount=paymentarr[i].fine_amount;
                obj.latefeeamount=paymentarr[i].latefee_amount;
                obj.installment=paymentarr[i].installment;
                obj.installmentamount=paymentarr[i].installment_amount;
                obj.actualamount=paymentarr[i].installment_amount;
                obj.discountamount=paymentarr[i].installment_amount;
                obj.paiddate=paymentarr[i].paid_date;
                obj.receiptno=paymentarr[i].receipt_no;
                obj.receiptdate=paymentarr[i].receiptdatee;
                obj.receipttype=paymentarr[i].receipttype;
                obj.hidereceipt=paymentarr[i].hidereceipt;
                obj.hideack=paymentarr[i].hideack;
                obj.chequeview=paymentarr[i].chequeview;
                obj.transferview=paymentarr[i].transferview;
                obj.paymentarr=tpparticular;
                obj.totalfees=tptotal;
                obj.hidecashparticular=false;
                obj.hidechequeparticular=true;
                obj.hidetransferparticular=true;
                obj.hidecurrreceipt=true;
                obj.hidelatefeecashparticular=true;
                obj.hidelatefeechequeparticular=true;
                if(obj.installment="Application fee")
                    obj.hidesplit=true;
                if(tpcnt==0)
                    feereceiptarr.push(obj);
                tpcnt++;
            }
            if(paymentarr[i].mode_of_payment=="Cheque"){
                var obj={"schoolid":"","academicyear":"","admissionno":"","studentname":"","grade":"","installment":"","paiddate":"","receiptno":"","receipttype":"","hidereceipt":"","hideack":"","chequeview":"","transferview":"","paymentarr":""};
                if(paymentarr[i].cheque_date<=paymentarr[i].received_date){
                    obj.modeofpayment=paymentarr[i].mode_of_payment;
                obj.schoolid=paymentarr[i].school_id;
                obj.academicyear=paymentarr[i].academic_year;
                obj.admissionno=paymentarr[i].admission_no;
                obj.studentname=paymentarr[i].student_name;
                obj.grade=paymentarr[i].grade;
                if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null){
            paymentarr[i].latefee_amount=0;
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=true;
            }
                obj.fineamount=paymentarr[i].fine_amount;
                obj.latefeeamount=paymentarr[i].latefee_amount;
                obj.installment=paymentarr[i].installment;
                obj.installmentamount=paymentarr[i].installment_amount;
                obj.receiveddate=paymentarr[i].received_date;
                obj.ackno=paymentarr[i].ack_no;
                obj.receiptdate=paymentarr[i].receiptdatee;
                obj.receipttype="RECEIPT";
                obj.hidereceipt=paymentarr[i].hidereceipt;
                obj.hideack=true;
                obj.chequeview=paymentarr[i].chequeview;
                obj.transferview=paymentarr[i].transferview;
                obj.paymentarr=currchequeparticular;
                obj.totalfees=currchequetotal;
                obj.hidecashparticular=true;
                obj.hidechequeparticular=false;
                obj.hidetransferparticular=true;
                obj.hidecurrreceipt=false;
                obj.hidelatefeecashparticular=true;
                obj.hidelatefeechequeparticular=true;
                if(obj.installment="Application fee")
                    obj.hidesplit=true;
                if(currchequecnt==0)
                    feereceiptarr.push(obj);
                currchequecnt++;
                }
                else{
                obj.modeofpayment=paymentarr[i].mode_of_payment;
                obj.schoolid=paymentarr[i].school_id;
                obj.academicyear=paymentarr[i].academic_year;
                obj.admissionno=paymentarr[i].admission_no;
                obj.studentname=paymentarr[i].student_name;
                obj.grade=paymentarr[i].grade;
                if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null){
            paymentarr[i].latefee_amount=0;
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=true;
            }
                obj.fineamount=paymentarr[i].fine_amount;
                obj.latefeeamount=paymentarr[i].latefee_amount;
                obj.installment=paymentarr[i].installment;
                obj.installmentamount=paymentarr[i].installment_amount;
                obj.receiveddate=paymentarr[i].received_date;
                obj.ackno=paymentarr[i].ack_no;
                obj.receiptdate=paymentarr[i].receiptdatee;
                obj.receipttype=paymentarr[i].receipttype;
                obj.hidereceipt=paymentarr[i].hidereceipt;
                obj.hideack=paymentarr[i].hideack;
                obj.chequeview=paymentarr[i].chequeview;
                obj.transferview=paymentarr[i].transferview;
                obj.paymentarr=chequeparticular;
                obj.totalfees=chequetotal;
                obj.hidecashparticular=true;
                obj.hidechequeparticular=false;
                obj.hidetransferparticular=true;
                obj.hidecurrreceipt=true;
                obj.hidelatefeecashparticular=true;
                obj.hidelatefeechequeparticular=true;
                if(obj.installment="Application fee")
                    obj.hidesplit=true;
                if(chequecnt==0)
                    feereceiptarr.push(obj);
                chequecnt++;
                }
            }
            if(paymentarr[i].mode_of_payment=="Transfer"||paymentarr[i].mode_of_payment=="Card Swipe"){
                var obj={"schoolid":"","academicyear":"","admissionno":"","studentname":"","grade":"","installment":"","paiddate":"","receiptno":"","receipttype":"","hidereceipt":"","hideack":"","chequeview":"","transferview":"","paymentarr":""};
                obj.modeofpayment=paymentarr[i].mode_of_payment;
                obj.schoolid=paymentarr[i].school_id;
                obj.academicyear=paymentarr[i].academic_year;
                obj.admissionno=paymentarr[i].admission_no;
                obj.studentname=paymentarr[i].student_name;
                obj.grade=paymentarr[i].grade;
                if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null){
            paymentarr[i].latefee_amount=0;
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=true;
            }
                obj.fineamount=paymentarr[i].fine_amount;
                obj.latefeeamount=paymentarr[i].latefee_amount;
                obj.installment=paymentarr[i].installment;
                obj.installmentamount=paymentarr[i].installment_amount;
                obj.paiddate=paymentarr[i].paid_date;
                obj.receiptno=paymentarr[i].receipt_no;
                obj.receiptdate=paymentarr[i].receiptdatee;
                obj.receipttype=paymentarr[i].receipttype;
                obj.hidereceipt=paymentarr[i].hidereceipt;
                obj.hideack=paymentarr[i].hideack;
                obj.chequeview=paymentarr[i].chequeview;
                obj.transferview=paymentarr[i].transferview;
                obj.paymentarr=transferparticular;
                obj.totalfees=transfertotal;
                obj.hidecashparticular=true;
                obj.hidechequeparticular=true;
                obj.hidetransferparticular=false;
                obj.hidecurrreceipt=true;
                obj.hidelatefeecashparticular=true;
                obj.hidelatefeechequeparticular=true;
                if(obj.installment="Application fee")
                    obj.hidesplit=true;
                if(transfercnt==0)
                    feereceiptarr.push(obj);
                transfercnt++;
            }
        }
        // alert(JSON.stringify(feereceiptarr));
        
        for(var i=0;i<feereceiptarr.length;i++){

            if(feereceiptarr[i].modeofpayment=="Cheque"){
                // new Date(feereceiptarr[i].paiddate);
                var d=new Date(feereceiptarr[i].receiptdate);
                var dt=d.getDate();
                if(dt<9)
                    dt="0"+dt;                
                var mn=d.getMonth()+1;
                if(mn<9)
                    mn="0"+mn;
                var yr=d.getFullYear();
                var dat=dt+"-"+mn+"-"+yr;
                feereceiptarr[i].receiptdate=dat
            }
            else{
                var d1=new Date(feereceiptarr[i].paiddate);
                var d2=new Date(feereceiptarr[i].receiptdate);
                var dt1=d1.getDate();
                if(dt1<9)
                    dt1="0"+dt1;
                var mn1=d1.getMonth()+1;
                if(mn1<9)
                    mn1="0"+mn1;
                var yr1=d1.getFullYear();
                var dat1=dt1+"-"+mn1+"-"+yr1;
                var dt2=d2.getDate();
                if(dt2<9)
                    dt2="0"+dt2;
                var mn2=d2.getMonth()+1;
                if(mn2<9)
                    mn2="0"+mn2;
                var yr2=d2.getFullYear();
                var dat2=dt2+"-"+mn2+"-"+yr2;
                feereceiptarr[i].paiddate=dat1;
                feereceiptarr[i].receiptdate=dat2;
            }
        }
        this.FnFormStructure();
        // this.callFeeReceipt();
      },

      FnFormStructure:function(){
        // alert(JSON.stringify(this.splitarr));
        // alert(JSON.stringify(studsplitarr));
        this.callFeeReceipt();
      },

      fetchInstallmentseperationResponse:function(e){
        
      },
      callFeeReceipt:function(){
        alert('Fee paid!!');
        // alert('calling receipt');
        // alert(JSON.stringify(feereceiptarr));
        document.querySelector('feereceipt-outcard').Fnsetinfo();
        document.querySelector('feereceipt-outcard').paymentreceiptarr=feereceiptarr;
        // document.querySelector('feereceipt-outcard').paymentreceiptarr=paymentarr;
        // document.querySelector('CRM-app').setPage('feereceipt-outcard');
        document.querySelector('CRM-app').setPage('feereceipt-outcard');
        // window.open('../elements/receiptindex.html', '_blank');
        paymentarr=[];
        paymentlength=0;
        paymentcount=0;
        feereceiptarr=[];
        feecashcount=0;
        feechequecount=0;
        feetransfercount=0;
        arr=[];
        localStorage.setItem("curr_sess_discountfeetype","");
      },
      FnSetSplitup:function(splitarr){
        this.splitarr=splitarr;
        studsplitarr=[];
        for(var i=0;i<splitarr.length;i++){
            studsplitarr.push(splitarr[i]);
        }
        // alert(JSON.stringify(this.splitarr));
        // if(localStorage.getItem("curr_sess_installmentpattern")=="1"){
        
        // }
      },
      insertinstallmentsplitofstudService:function(){
        for(var i=0;i<studsplitarr.length;i++){
        this.insertinstallmentsplitofstudurl=sessionStorage.getItem("addrinfo")+"/insertinstallmentsplitofstud";
        var obj={};
        obj.schoolid=localStorage.getItem("schoolid"); 
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.admissionno=localStorage.getItem("curr_sess_enquiryno");
        obj.installment=studsplitarr[i].installment;
        obj.installmentamount=studsplitarr[i].installmentamount;
        obj.installmentdate=studsplitarr[i].installmentdate;
        obj.actualamount=studsplitarr[i].actualamount;
        obj.discountamount=studsplitarr[i].discountamount;
        for(var j=0;j<studsplitarr[i].fees.length;j++){
            obj.feetype=studsplitarr[i].fees[j].feetype;
            obj.feetypeactualamount=studsplitarr[i].fees[j].actualamount;
            obj.feetypeamount=studsplitarr[i].fees[j].amount;
            obj.createdby=localStorage.getItem("employeeid"); 
        this.insertinstallmentsplitofstudparam=obj;              
        this.$.insertinstallmentsplitofstudajax.generateRequest();
        }        
        }        
      },
      insertinstallmentsplitofstudResponse:function(e){
        // alert(e.detail.response.returnval);
      },
      insertstudwisefeesplitupService:function(split,paymentarr){
        // alert(JSON.stringify(paymentarr));
        if((localStorage.getItem("curr_sess_installmentpattern")!="3")){
        for(var i=0;i<split.length;i++){
        this.insertstudwisefeesplitupurl=sessionStorage.getItem("addrinfo")+"/insertstudwisefeesplitup";
        var obj={};
        obj.schoolid=localStorage.getItem("schoolid"); 
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.admissionno=localStorage.getItem("curr_sess_enquiryno");   
        obj.installment=split[i].installment;
        obj.installmentamount=split[i].installmentamount;
        obj.actualamount=split[i].actualamount;
        obj.discountamount=split[i].discountamount;
        for(var j=0;j<split[i].fees.length;j++){
            obj.feetype=split[i].fees[j].feetype;
            obj.feetypeactualamount=split[i].fees[j].feetypeactualamount;
            obj.feetypeamount=split[i].fees[j].feetypeamount;
            // obj.createdby=localStorage.getItem("employeeid"); 
        this.insertstudwisefeesplitupparam=obj;              
        this.$.insertstudwisefeesplitupajax.generateRequest();
        }        
        }    
        }    
        else{
        for(var i=0;i<paymentarr.length;i++){
        this.insertstudwisefeesplitupurl=sessionStorage.getItem("addrinfo")+"/insertstudwisefeesplitup";
        var obj={};
        obj.schoolid=localStorage.getItem("schoolid"); 
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.admissionno=localStorage.getItem("curr_sess_enquiryno");   
        obj.installment=paymentarr[i].installment;
        obj.installmentamount=paymentarr[i].installment_amount;
        obj.actualamount=paymentarr[i].installment_amount;
        obj.discountamount=localStorage.getItem("curr_sess_discountpercentamt");
        for(var j=0;j<paymentarr[i].fees.length;j++){
            obj.feetype=paymentarr[i].fees[j].feetype;
            // obj.feetypeactualamount=paymentarr[i].fees[j].feetypeactualamount;
            obj.feetypeamount=paymentarr[i].fees[j].feetypeamount;
            // obj.createdby=localStorage.getItem("employeeid"); 
        this.insertstudwisefeesplitupparam=obj;              
        this.$.insertstudwisefeesplitupajax.generateRequest();
        }        
        }    
        }
      },
      insertstudwisefeesplitupResponse:function(e){

      }
    });
  })();
  </script>
</dom-module>
