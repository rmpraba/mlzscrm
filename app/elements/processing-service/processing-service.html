<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="processing-service">
  <template>
    <!-- It would fetch fees -->
     <iron-ajax
        method="post"
        id="fetchprocessingchequeajax"
        url="{{fetchprocessingchequeurl}}"
        params="{{fetchprocessingchequeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchprocessingchequeResponse"
        debounce-duration="300"
        >
        <!-- It would fetch fees -->
     <iron-ajax
        method="post"
        id="searchfeeadmissionajax"
        url="{{searchfeeadmissionurl}}"
        params="{{searchfeeadmissionparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="searchfeeadmissionResponse"
        debounce-duration="300"
        >
        
         <!-- It would fetch fees -->
     <iron-ajax
        method="post"
        id="searchwithdrawchequesajax"
        url="{{searchwithdrawchequesurl}}"
        params="{{searchwithdrawchequesparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="searchwithdrawchequesResponse"
        debounce-duration="300"
        >
         <!-- It would fetch fees -->
     <iron-ajax
        method="post"
        id="searchwithdrawfeessajax"
        url="{{searchwithdrawfeesurl}}"
        params="{{searchwithdrawfeesparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="searchwithdrawfeesResponse"
        debounce-duration="300"
        >
        
        <iron-ajax
        method="post"
        id="insertreturninfoajax"
        url="{{insertreturninfourl}}"
        params="{{insertreturninfoparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="insertreturninfoResponse"
        debounce-duration="300"
        >
        <iron-ajax
        method="post"
        id="updatewithdrawstatusajax"
        url="{{updatewithdrawstatusurl}}"
        params="{{updatewithdrawstatusparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="updatewithdrawstatusResponse"
        debounce-duration="300"
        >
        <iron-ajax
        method="post"
        id="updatechequestatusajax"
        url="{{updatechequestatusurl}}"
        params="{{updatechequestatusparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="updatechequestatusResponse"
        debounce-duration="300"
        >
        <iron-ajax
        method="post"
        id="fetchreceiptajax"
        url="{{fetchreceipturl}}"
        params="{{fetchreceiptparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchreceiptResponse"
        debounce-duration="300"
        >
        <iron-ajax
        method="post"
        id="fetchsplitupajax"
        url="{{fetchsplitupurl}}"
        params="{{fetchsplitupparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchsplitupResponse"
        debounce-duration="300"
        >
        <iron-ajax
        method="post"
        id="processbouncechequeajax"
        url="{{processbouncechequeurl}}"
        params="{{processbouncechequeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="processbouncechequeResponse"
        debounce-duration="300"
        >
        <iron-ajax
        method="post"
        id="fetchchequeforeditordeleteajax"
        url="{{fetchchequeforeditordeleteurl}}"
        params="{{fetchchequeforeditordeleteparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchchequeforeditordeleteResponse"
        debounce-duration="300"
        >
        <iron-ajax
        method="post"
        id="editchequeajax"
        url="{{editchequeurl}}"
        params="{{editchequeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="editchequeResponse"
        debounce-duration="300"
        >
        <iron-ajax
        method="post"
        id="deletechequeajax"
        url="{{deletechequeurl}}"
        params="{{deletechequeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="deletechequeResponse"
        debounce-duration="300"
        >
        
        <iron-ajax
        method="post"
        id="fetchstudfeesplitupajax"
        url="{{fetchstudfeesplitupurl}}"
        params="{{fetchstudfeesplitupparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchstudfeesplitupResponse"
        debounce-duration="300"
        >
        
        <iron-ajax
        method="post"
        id="fetchdiscounttypesajax"
        url="{{fetchdiscounttypesurl}}"
        params="{{fetchdiscounttypesparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchdiscounttypesResponse"
        debounce-duration="300"
        >

        <iron-ajax
        method="post"
        id="fetchstudenttoattachdiscountajax"
        url="{{fetchstudenttoattachdiscounturl}}"
        params="{{fetchstudenttoattachdiscountparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchstudenttoattachdiscountResponse"
        debounce-duration="300"
        >

        <iron-ajax
        method="post"
        id="attachdiscountajax"
        url="{{attachdiscounturl}}"
        params="{{attachdiscountparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="attachdiscountResponse"
        debounce-duration="300"
        >
        
        <iron-ajax
        method="post"
        id="updateadhocdiscountajax"
        url="{{updateadhocdiscounturl}}"
        params="{{updateadhocdiscountparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="updateadhocdiscountResponse"
        debounce-duration="300"
        >

        <iron-ajax
        method="post"
        id="fetchmasterpaidfeeajax"
        url="{{fetchmasterpaidfeeurl}}"
        params="{{fetchmasterpaidfeeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchmasterpaidfeeResponse"
        debounce-duration="300"
        >
        <iron-ajax
        method="post"
        id="updatelatefeeajax"
        url="{{updatelatefeeurl}}"
        params="{{updatelatefeeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="updatelatefeeResponse"
        debounce-duration="300"
        >
        
        <iron-ajax
        method="post"
        id="updatedefaulterajax"
        url="{{updatedefaulterurl}}"
        params="{{updatedefaulterparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="updatedefaulterResponse"
        debounce-duration="300"
        >

        <iron-ajax
        method="post"
        id="fetchstudentdeldiscountServiceajax"
        url="{{fetchstudentdeldiscountServiceurl}}"
        params="{{fetchstudentdeldiscountServiceparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchstudentdeldiscountResponse"
        debounce-duration="300"
        >
            <!-- this comes under Delete Discount -->

        <iron-ajax
        method="post"
        id="deltediscountajax"
        url="{{deltediscounturl}}"
        params="{{deltediscountparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="deltediscountResponse"
        debounce-duration="300"
        >
  </template>
  <script>
  (function() {
    'use strict';
    var count1=0;
    var count2=0;
    var feereceiptarr=[];
    var splituparr=[];
    var paymentarr=[];
    Polymer({
      is: 'processing-service',
      FnFetchprocessingchequeService:function(){
        this.fetchprocessingchequeurl=sessionStorage.getItem("addrinfo")+"/fetchprocessingcheque-service";
        var obj={"schoolid":"","fromdate":"","todate":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.fromdate=localStorage.getItem("localsess_from_date");
        obj.todate=localStorage.getItem("localsess_to_date");
        this.fetchprocessingchequeparam=obj;
        this.$.fetchprocessingchequeajax.generateRequest();
      },
      fetchprocessingchequeResponse:function(e){
        var arr=e.detail.response.returnval;
        if(arr.length!='no rows'){
        for(var i=0;i<arr.length;i++){
          arr[i].sno=i+1;
        }
        document.querySelector('cheque-realization-card').chequearr=arr;
        document.querySelector('cheque-realization-card').FnSetChequeArray(arr);
        }
      },
      searchfeeadmissionService:function(admissionno){
        this.searchfeeadmissionurl=sessionStorage.getItem("addrinfo")+"/searchfeeadmission";
        // localStorage.setItem("curr_sess_insertflag",2);
        var obj={"admissionno":"","schoolid":""};
        obj.admissionno=admissionno;
        obj.schoolid=localStorage.getItem("schoolid");
        this.searchfeeadmissionparam=obj;
        this.$.searchfeeadmissionajax.generateRequest();
     },
      searchfeeadmissionResponse:function(e){
        var admnarr=e.detail.response.returnval;
        var arr=[]; 
        if(admnarr.length>0)  {     
        for(var i=0;i<admnarr.length;i++){
        var obj={"enquiry_no":"","enquiry_name":""};
        localStorage.setItem('curr_sess_enquiredno',admnarr[i].enquiry_no);
        obj.enquiry_no=admnarr[i].admission_no;
        obj.enquiry_name=admnarr[i].student_name;  
        arr.push(obj); 
        }
        localStorage.setItem("curr_sess_admissionno",admnarr[0].admission_no);
        localStorage.setItem("curr_sess_studentname",admnarr[0].student_name);
        localStorage.setItem("curr_sess_academicyear",admnarr[0].academic_year);
        localStorage.setItem("curr_sess_grade",admnarr[0].class_for_admission);
        document.querySelector('withdrawal-card').enquiryarr=arr;
        }
      },
      searchwithdrawchequesService:function(admissionno){
        this.searchwithdrawchequesurl=sessionStorage.getItem("addrinfo")+"/searchwithdrawcheques-service";
        var obj={"admissionno":"","schoolid":""};
        obj.admissionno=admissionno;
        obj.enquiryno=localStorage.getItem('curr_sess_enquiryno');
        obj.schoolid=localStorage.getItem("schoolid");
        this.searchwithdrawchequesparam=obj;
        this.$.searchwithdrawchequesajax.generateRequest();
      },
      searchwithdrawchequesResponse:function(e){
        var totalamount=0;
        var paidamount=0;
        var arr=e.detail.response.returnval;
        for(var i=0;i<arr.length;i++){
          arr[i].sno=i+1;
          totalamount=parseFloat(parseFloat(arr[i].installment_amount)+parseFloat(totalamount)).toFixed(2);
          if(arr[i].paid_status=='paid')
          paidamount=parseFloat(parseFloat(arr[i].installment_amount)+parseFloat(paidamount)).toFixed(2);
        }
        document.querySelector('withdrawal-card').payableamount=totalamount;
        document.querySelector('withdrawal-card').paidamount=paidamount;
        document.querySelector('withdrawal-card').chequearr=arr;
      },
      FnInsertreturninfo:function(payableamount,paidamount,amounttoreturn,chequeno,bankname,paytype){
        this.insertreturninfourl=sessionStorage.getItem("addrinfo")+"/insertreturninfo-service";
        var obj={"admissionno":"","schoolid":""};
        obj.admissionno=localStorage.getItem("curr_sess_enquiryno");
        obj.studentname=localStorage.getItem("curr_sess_enquiryname");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.grade=localStorage.getItem("curr_sess_grade");
        obj.enquiryno=localStorage.getItem('curr_sess_enquiryno');
        obj.schoolid=localStorage.getItem("schoolid");
        obj.payableamount=payableamount;
        obj.paidamount=paidamount;
        obj.returnamount=amounttoreturn;
        obj.chequeno=chequeno;
        obj.bankname=bankname;
        obj.paytype=paytype;
        obj.createdby=localStorage.getItem("employeeid");
        obj.returndate=localStorage.getItem("curr_sess_chequedate");
        this.insertreturninfoparam=obj;
        this.$.insertreturninfoajax.generateRequest();
      },
      insertreturninfoResponse:function(e){
        var paymentarr=[]
        paymentarr.push(e.detail.response.info);
        var admninfo=e.detail.response.admninfo;
        // alert(JSON.stringify(admninfo));
        var feereceiptarr=[];
        var chequeparticular=[];
        // alert(JSON.stringify(e.detail.response.returnval)+"  "+localStorage.getItem("curr_sess_withdrawalflag"));
        alert(e.detail.response.returnval);
        if(e.detail.response.returnval=="Done!"){
          var obj={"admissionno":"","schoolid":""};
          obj.enquiryno=localStorage.getItem('curr_sess_enquiredno');
          obj.schoolid=localStorage.getItem("schoolid");
          obj.admissionno=localStorage.getItem("curr_sess_admissionno");
          this.updatewithdrawstatusurl=sessionStorage.getItem("addrinfo")+"/updatewithdrawstatus-service";
          this.updatewithdrawstatusparam=obj;
          this.$.updatewithdrawstatusajax.generateRequest();
        }
        if(localStorage.getItem("curr_sess_withdrawalflag")=="1"){
        if(paymentarr.length>0){
        // alert("hi..."+JSON.stringify(paymentarr[0].paytype));
         if(paymentarr[0].paytype=="Cash"){
                var obj={"schoolid":"","academicyear":"","admissionno":"","studentname":"","grade":"","installment":"","paiddate":"","receiptno":"","receipttype":"","hidereceipt":"","hideack":"","chequeview":"","transferview":"","paymentarr":""};
                var cashparticular=[];
                cashparticular.push({"slno":1,"installment":"Return Amount","feetype":"Withdrawal","installmentamount":paymentarr[0].returned_amount});
                obj.schoolid=paymentarr[0].school_id;
                obj.academicyear=paymentarr[0].academic_year;
                obj.admissionno=paymentarr[0].admission_no;
                obj.studentname=paymentarr[0].student_name;
                obj.grade=admninfo[0].class_for_admission;
                obj.parentname=admninfo[0].father_name;
                localStorage.setItem("curr_sess_parentname",admninfo[0].father_name);
                obj.installment="Return amount";
                obj.installmentamount=paymentarr[0].returned_amount;
                obj.paiddate=paymentarr[0].returned_date;
                obj.receiptdate=paymentarr[0].returned_date;
                obj.receiveddate=paymentarr[0].returned_date;
                obj.receiptno=paymentarr[0].ack_no;
                obj.receipttype="ACKNOWLEDGEMENT";
                obj.hidereceipt=false;
                obj.hidecurrreceipt=true;
                obj.hideack=true;
                obj.chequeview=true;
                obj.transferview=true;
                obj.hidesplit=true;
                obj.modeofpayment=paymentarr[0].paytype;
                obj.hidelatefeecashparticular=true;
                obj.hidelatefeechequeparticular=true;
                obj.paymentarr=cashparticular;
                obj.totalfees=paymentarr[0].returned_amount;
                obj.hidecashparticular=false;
                obj.hidechequeparticular=true;
                obj.hidetransferparticular=true;                
                feereceiptarr.push(obj);
                
            }
            if(paymentarr[0].paytype=="Cheque"){
                var obj={"schoolid":"","academicyear":"","admissionno":"","studentname":"","grade":"","installment":"","paiddate":"","receiptno":"","receipttype":"","hidereceipt":"","hideack":"","chequeview":"","transferview":"","paymentarr":""};
                // alert(paymentarr[0].bank_name);
                chequeparticular.push({"slno":1,"installment":"Return Amount","feetype":"Withdrawal","bankname":paymentarr[0].bank_name,"chequeno":paymentarr[0].cheque_no,"chequedate":paymentarr[0].returned_date,"installmentamount":paymentarr[0].returned_amount});
                obj.schoolid=paymentarr[0].school_id;
                obj.academicyear=paymentarr[0].academic_year;
                obj.admissionno=paymentarr[0].admission_no;
                obj.studentname=paymentarr[0].student_name;
                obj.grade=admninfo[0].class_for_admission;
                obj.parentname=admninfo[0].father_name;
                localStorage.setItem("curr_sess_parentname",admninfo[0].father_name);
                obj.installment="Return amount";
                obj.installmentamount=paymentarr[0].returned_amount;
                obj.receiveddate=paymentarr[0].returned_date;
                obj.receiptdate=paymentarr[0].returned_date;
                obj.receiveddate=paymentarr[0].returned_date;
                obj.chequedate=paymentarr[0].cheque_date;
                obj.bankname=paymentarr[0].bank_name;
                obj.ackno=paymentarr[0].ack_no;
                obj.receipttype="ACKNOWLEDGEMENT";
                obj.hidereceipt=true;
                obj.hidecurrreceipt=true;
                obj.hideack=false;
                obj.chequeview=false;
                obj.transferview=true;
                obj.hidesplit=true;
                obj.modeofpayment=paymentarr[0].paytype;
                obj.hidelatefeecashparticular=true;
                obj.hidelatefeechequeparticular=true;
                obj.paymentarr=chequeparticular;
                obj.totalfees=paymentarr[0].returned_amount;
                obj.hidecashparticular=true;
                obj.hidechequeparticular=false;
                obj.hidetransferparticular=true;                
                feereceiptarr.push(obj);                
            }
            if(feereceiptarr.length>0){
             document.querySelector('feereceipt-outcard').paymentreceiptarr=feereceiptarr;
             document.querySelector('feereceipt-outcard').Fnsetinfo();
             document.querySelector('CRM-app').setPage('feereceipt-outcard');
             feereceiptarr=[];
           }
           }
        }

           document.querySelector('withdrawal-card').FnRefresh();
      },
      updatewithdrawstatusResponse:function(e){
        alert(e.detail.response.returnval);
      },
      FnUpdateChequeStatus:function(cheque){
        count1=cheque.length;
        this.updatechequestatusurl=sessionStorage.getItem("addrinfo")+"/updatechequestatus-service";
        for(var i=0;i<cheque.length;i++){ 
          var obj={"schoolid":""};
          var d=new Date();
        
        obj.schoolid=cheque[i].school_id; 
        obj.academicyear=cheque[i].academic_year; 
        obj.admissionno=cheque[i].admission_no; 
        obj.studentname=cheque[i].student_name; 
        obj.grade=cheque[i].grade; 
        obj.installmenttype=cheque[i].installment_type; 
        obj.installment=cheque[i].installment; 
        obj.receiveddate=cheque[i].received_date;       
        obj.paidstatus=cheque[i].paid_status; 
        obj.chequeno=(cheque[i].cheque_no);        
        obj.bankname=cheque[i].bank_name; 
        obj.chequestatus=cheque[i].status; 
        obj.realiseddate=(d.getMonth()+1)+"/"+d.getDate()+"/"+d.getFullYear();
        obj.createdby=localStorage.getItem("employeeid");     
        this.updatechequestatusparam=obj;     
        this.$.updatechequestatusajax.generateRequest();
        }
      },
      updatechequestatusResponse:function(e){
        if(e.detail.response.returnval=="Updated!")
          count2++;
        if(count1==count2){
           alert('Cheques are updated!');
           count1=0;
           count2=0;
           document.querySelector('chequebounceorcancel-card').FnRefresh();
           // this.FnFetchprocessingchequeService();
        }      
      },
      fetchreceiptService:function(admissionno,name){
        // alert(admissionno+" "+name);
        this.fetchreceipturl=sessionStorage.getItem("addrinfo")+"/fetchreceipt-service";
        var obj={"schoolid":"","admissionno":"","name":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.admissionno=admissionno;
        obj.name=name;
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        this.fetchreceiptparam=obj;     
        this.$.fetchreceiptajax.generateRequest();
      },
      fetchreceiptResponse:function(e){
        // alert(JSON.stringify(e.detail.response.returnval));
        var arr=e.detail.response.returnval;
        if(arr.length>0)
        {
          // alert(arr[0].fathername);
          localStorage.setItem("curr_sess_parentname",arr[0].fathername);
          document.querySelector('feereceipt-outcard').Fnsetinfo();
          paymentarr=arr;
          // this.fetchstudfeesplitupService();
          this.fetchmasterpaidfeeService();
          // var feecode=arr[0].fee_code;
          // alert(arr[0].fee_code);
          // this.fetchsplitupService(arr[0].fee_code);
          // this.FnProcessReceipt(arr);
        }
      },
      fetchmasterpaidfeeService:function(){
        this.fetchmasterpaidfeeurl=sessionStorage.getItem("addrinfo")+"/fetchmasterpaidfee-service";
        var obj={"schoolid":"","admissionno":"","name":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.admissionno=localStorage.getItem("curr_sess_enquiryno");
        // obj.name=name;
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        this.fetchmasterpaidfeeparam=obj;     
        this.$.fetchmasterpaidfeeajax.generateRequest();
      },
      fetchmasterpaidfeeResponse:function(e){
        var arr=e.detail.response.returnval;
        // alert(JSON.stringify(arr.length));
        if(arr!='no rows'){
            var flag=arr[0].paymenttype_flag;
            if(flag=='0')
                this.fetchstudfeesplitupService();
            if(flag=='1')
                this.FnFormcustomreceiptstructure(arr);
        }
      },
      FnFormcustomreceiptstructure:function(paymentarr){
        for(var i=0;i<paymentarr.length;i++){
            paymentarr[i].flag=0;
        }
        for(var i=0;i<paymentarr.length;i++){
        var cashparticular=[];
        var chequeparticular=[];
        var transferparticular=[];
        var tpparticular=[];
        var cashtotal=0;
        var chequetotal=0;
        var transfertotal=0; 
        var tptotal=0; 
        var cashno=1;
        var chequeno=1;
        var transferno=1;       
        var tpno=1; 
        var cashcnt=0;
        var chequecnt=0;
        var transfercnt=0;
        var tpcnt=0;

          if(paymentarr[i].mode_of_payment=="Cash"&&paymentarr[i].flag==0)
          {
            paymentarr[i].flag=1;
            var obj={"schoolid":"","academicyear":"","admissionno":"","studentname":"","grade":"","installment":"","paiddate":"","receiptno":"","receipttype":"","hidereceipt":"","hideack":"","chequeview":"","transferview":"","paymentarr":""};
            obj.modeofpayment=paymentarr[i].mode_of_payment;
            obj.schoolid=paymentarr[i].school_id;
            obj.academicyear=paymentarr[i].academic_year;
            obj.admissionno=paymentarr[i].admission_no;
            obj.studentname=paymentarr[i].student_name;
            obj.grade=paymentarr[i].grade;
            if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null){
            paymentarr[i].latefee_amount=0;
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=true;
            } 
            else{
            if(paymentarr[i].latefee_paymentmode=="Cash"){
            obj.hidelatefeecashparticular=false;
            obj.hidelatefeechequeparticular=true;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;
            }
            else{
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=false;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latebankname=paymentarr[i].latefee_bankname;
            obj.laterefno=paymentarr[i].latefee_refno;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;   
            }
            }
            obj.fineamount=paymentarr[i].fine_amount;            
            obj.installment=paymentarr[i].installment;
            obj.receiptdate=paymentarr[i].receipt_date;
            obj.receiptno=paymentarr[i].receipt_no;
            obj.receipttype="RECEIPT";
            obj.hidecurrreceipt=true;
            obj.hidereceipt=false;
            obj.hideack=true;
            obj.chequeview=true;
            obj.transferview=true;
            obj.hidecashparticular=false;
            obj.hidechequeparticular=true;
            obj.hidetransferparticular=true;
            obj.hidesplit=true;
            cashtotal=parseFloat(parseFloat(paymentarr[i].installment_amount)+parseFloat(cashtotal)+parseFloat(paymentarr[i].fine_amount)).toFixed(2);
            cashparticular.push({"slno":cashno,"installment":paymentarr[i].installment_type,"installmentamount":paymentarr[i].installment_amount,"feetype":paymentarr[i].fees});
            for(var j=i+1;j<paymentarr.length;j++){

              if(paymentarr[i].receipt_no==paymentarr[j].receipt_no){
              paymentarr[j].flag=1;
              cashno++;
              if(paymentarr[j].fine_amount==""||paymentarr[j].fine_amount==null)
              paymentarr[j].fine_amount=0;
              if(paymentarr[j].latefee_amount==""||paymentarr[j].latefee_amount==null)
              paymentarr[j].latefee_amount=0;
              cashtotal=parseFloat(parseFloat(paymentarr[j].installment_amount)+parseFloat(cashtotal)+parseFloat(paymentarr[j].fine_amount)).toFixed(2);
              cashparticular.push({"slno":cashno,"installment":paymentarr[j].installment_type,"installmentamount":paymentarr[j].installment_amount,"feetype":paymentarr[j].fees});
              // paymentarr.splice(j,1);             
              }
            }

            obj.totalfees=cashtotal;
            obj.paymentarr=cashparticular;
            // cashno=1;
            // cashtotal=0;
            // paymentarr.splice(i,1);
            feereceiptarr.push(obj);
          }
          if(paymentarr[i].mode_of_payment=="Third Party"&&paymentarr[i].flag==0)
          {
            paymentarr[i].flag=1;
            var obj={"schoolid":"","academicyear":"","admissionno":"","studentname":"","grade":"","installment":"","paiddate":"","receiptno":"","receipttype":"","hidereceipt":"","hideack":"","chequeview":"","transferview":"","paymentarr":""};
            obj.modeofpayment=paymentarr[i].mode_of_payment;
            obj.schoolid=paymentarr[i].school_id;
            obj.academicyear=paymentarr[i].academic_year;
            obj.admissionno=paymentarr[i].admission_no;
            obj.studentname=paymentarr[i].student_name;
            obj.grade=paymentarr[i].grade;
            if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null){
            paymentarr[i].latefee_amount=0;
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=true;
            } 
            else{
            if(paymentarr[i].latefee_paymentmode=="Cash"){
            obj.hidelatefeecashparticular=false;
            obj.hidelatefeechequeparticular=true;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;
            }
            else{
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=false;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latebankname=paymentarr[i].latefee_bankname;
            obj.laterefno=paymentarr[i].latefee_refno;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;   
            }
            }
            obj.fineamount=paymentarr[i].fine_amount;
           
            obj.installment=paymentarr[i].installment;
            obj.receiptdate=paymentarr[i].receipt_date;
            obj.receiptno=paymentarr[i].receipt_no;
            obj.receipttype="RECEIPT";
            obj.hidecurrreceipt=true;
            obj.hidereceipt=false;
            obj.hideack=true;
            obj.chequeview=true;
            obj.transferview=true;
            obj.hidecashparticular=false;
            obj.hidechequeparticular=true;
            obj.hidetransferparticular=true;
            obj.hidesplit=true;
            tptotal=parseFloat(parseFloat(paymentarr[i].installment_amount)+parseFloat(cashtotal)+parseFloat(paymentarr[i].fine_amount)).toFixed(2);
            tpparticular.push({"slno":tpno,"installment":paymentarr[i].installment_type,"installmentamount":paymentarr[i].installment_amount,"feetype":paymentarr[i].fees});
            for(var j=i+1;j<paymentarr.length;j++){

              if(paymentarr[i].receipt_no==paymentarr[j].receipt_no){
              paymentarr[j].flag=1;
              tpno++;
            if(paymentarr[j].fine_amount==""||paymentarr[j].fine_amount==null)
            paymentarr[j].fine_amount=0;
            if(paymentarr[j].latefee_amount==""||paymentarr[j].latefee_amount==null)
            paymentarr[j].latefee_amount=0;
              tptotal=parseFloat(parseFloat(paymentarr[j].installment_amount)+parseFloat(tptotal)+parseFloat(paymentarr[j].fine_amount)).toFixed(2);
              tpparticular.push({"slno":tpno,"installment":paymentarr[j].installment_type,"installmentamount":paymentarr[j].installment_amount,"feetype":paymentarr[j].fees});
              // paymentarr.splice(j,1);             
              }
            }

            obj.totalfees=tptotal;
            obj.paymentarr=tpparticular;
            // cashno=1;
            // cashtotal=0;
            // paymentarr.splice(i,1);
            feereceiptarr.push(obj);
          }
          if(paymentarr[i].mode_of_payment=="Cheque"&&paymentarr[i].paid_status=="cleared"&&paymentarr[i].flag==0)
          {
            paymentarr[i].flag=1;
            var obj={"schoolid":"","academicyear":"","admissionno":"","studentname":"","grade":"","installment":"","paiddate":"","receiptno":"","receipttype":"","hidereceipt":"","hideack":"","chequeview":"","transferview":"","paymentarr":""};
            obj.modeofpayment=paymentarr[i].mode_of_payment;
            obj.schoolid=paymentarr[i].school_id;
            obj.academicyear=paymentarr[i].academic_year;
            obj.admissionno=paymentarr[i].admission_no;
            obj.studentname=paymentarr[i].student_name;
            obj.grade=paymentarr[i].grade;
            if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null){
            paymentarr[i].latefee_amount=0;
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=true;
            } 
            else{
            if(paymentarr[i].latefee_paymentmode=="Cash"){
            obj.hidelatefeecashparticular=false;
            obj.hidelatefeechequeparticular=true;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;
            }
            else{
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=false;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latebankname=paymentarr[i].latefee_bankname;
            obj.laterefno=paymentarr[i].latefee_refno;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;   
            }
            }
            obj.fineamount=paymentarr[i].fine_amount;
            // obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.installment=paymentarr[i].installment;
            obj.receiptdate=paymentarr[i].receipt_date;
            obj.receiptno=paymentarr[i].receipt_no;
            obj.receipttype="RECEIPT";
            obj.hidecurrreceipt=true;
            obj.hidereceipt=false;
            obj.hideack=true;
            obj.chequeview=false;
            obj.transferview=true;
            obj.hidecashparticular=true;
            obj.hidechequeparticular=false;
            obj.hidetransferparticular=true;
            obj.hidesplit=true;
            chequetotal=parseFloat(parseFloat(paymentarr[i].installment_amount)+parseFloat(chequetotal)+parseFloat(paymentarr[i].fine_amount)).toFixed(2);
            chequeparticular.push({"slno":chequeno,"installment":paymentarr[i].installment_type,"bankname":paymentarr[i].bank_name,"chequeno":paymentarr[i].cheque_no,"chequedate":paymentarr[i].installment_date,"installmentamount":paymentarr[i].installment_amount,"feetype":paymentarr[i].fees});
            for(var j=i+1;j<paymentarr.length;j++){
              if(paymentarr[i].receipt_no==paymentarr[j].receipt_no){
              paymentarr[j].flag=1;
              chequeno++;
            if(paymentarr[j].fine_amount==""||paymentarr[j].fine_amount==null)
            paymentarr[j].fine_amount=0;
            if(paymentarr[j].latefee_amount==""||paymentarr[j].latefee_amount==null)
            paymentarr[j].latefee_amount=0;
              chequetotal=parseFloat(parseFloat(paymentarr[j].installment_amount)+parseFloat(chequetotal)+parseFloat(paymentarr[j].fine_amount)).toFixed(2);
              chequeparticular.push({"slno":chequeno,"installment":paymentarr[j].installment_type,"bankname":paymentarr[j].bank_name,"chequeno":paymentarr[j].cheque_no,"chequedate":paymentarr[j].installment_date,"installmentamount":paymentarr[j].installment_amount,"feetype":paymentarr[j].fees});              
              // paymentarr.splice(j,1);  
              }              
            }
            // paymentarr.splice(i,1);  
            // chequeno++;
            obj.totalfees=chequetotal;
            obj.paymentarr=chequeparticular;
            feereceiptarr.push(obj);
          }
          if(paymentarr[i].mode_of_payment=="Cheque"&&paymentarr[i].paid_status=="inprogress"&&paymentarr[i].flag==0)
          {
            var obj={"schoolid":"","academicyear":"","admissionno":"","studentname":"","grade":"","installment":"","paiddate":"","receiptno":"","receipttype":"","hidereceipt":"","hideack":"","chequeview":"","transferview":"","paymentarr":""};
            obj.modeofpayment=paymentarr[i].mode_of_payment;
            obj.schoolid=paymentarr[i].school_id;
            obj.academicyear=paymentarr[i].academic_year;
            obj.admissionno=paymentarr[i].admission_no;
            obj.studentname=paymentarr[i].student_name;
            obj.grade=paymentarr[i].grade;
            if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null)
            {
            paymentarr[i].latefee_amount=0;
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=true;
            } 
            else{
            if(paymentarr[i].latefee_paymentmode=="Cash"){
            obj.hidelatefeecashparticular=false;
            obj.hidelatefeechequeparticular=true;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;
            }
            else{
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=false;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latebankname=paymentarr[i].latefee_bankname;
            obj.laterefno=paymentarr[i].latefee_refno;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;   
            }
            }
            obj.fineamount=paymentarr[i].fine_amount;
            // obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.installment=paymentarr[i].installment;
            obj.receiptdate=paymentarr[i].receipt_date;
            obj.ackno=paymentarr[i].receipt_no;
            obj.receipttype="ACKNOWLEDGEMENT";
            obj.hidecurrreceipt=true;
            obj.hidereceipt=true;
            obj.hideack=false;
            obj.chequeview=false;
            obj.transferview=true;
            obj.hidecashparticular=true;
            obj.hidechequeparticular=false;
            obj.hidetransferparticular=true;
            obj.hidesplit=true;
            chequetotal=parseFloat(parseFloat(paymentarr[i].installment_amount)+parseFloat(chequetotal)+parseFloat(paymentarr[i].fine_amount)).toFixed(2);
            chequeparticular.push({"slno":chequeno,"installment":paymentarr[i].installment_type,"bankname":paymentarr[i].bank_name,"chequeno":paymentarr[i].cheque_no,"chequedate":paymentarr[i].installment_date,"installmentamount":paymentarr[i].installment_amount,"feetype":paymentarr[i].fees});
            for(var j=i+1;j<paymentarr.length;j++){
              if(paymentarr[i].receipt_no==paymentarr[j].receipt_no){
              paymentarr[j].flag=1;
              chequeno++;
              if(paymentarr[j].fine_amount==""||paymentarr[j].fine_amount==null)
            paymentarr[j].fine_amount=0;
            if(paymentarr[j].latefee_amount==""||paymentarr[j].latefee_amount==null)
            
            paymentarr[j].latefee_amount=0;
           
              chequetotal=parseFloat(parseFloat(paymentarr[j].installment_amount)+parseFloat(chequetotal)+parseFloat(paymentarr[j].fine_amount)).toFixed(2);
              chequeparticular.push({"slno":chequeno,"installment":paymentarr[j].installment_type,"bankname":paymentarr[j].bank_name,"chequeno":paymentarr[j].cheque_no,"chequedate":paymentarr[j].installment_date,"installmentamount":paymentarr[j].installment_amount,"feetype":paymentarr[j].fees});             
              // paymentarr.splice(j,1);  
              }
            }
            // chequeno++;
            // paymentarr.splice(i,1);  
            obj.totalfees=chequetotal;
            obj.paymentarr=chequeparticular;
            feereceiptarr.push(obj);
          }

          if((paymentarr[i].mode_of_payment=="Transfer"||paymentarr[i].mode_of_payment=="Card Swipe")&&paymentarr[i].flag==0)
          {
            var obj={"schoolid":"","academicyear":"","admissionno":"","studentname":"","grade":"","installment":"","paiddate":"","receiptno":"","receipttype":"","hidereceipt":"","hideack":"","chequeview":"","transferview":"","paymentarr":""};
            obj.modeofpayment=paymentarr[i].mode_of_payment;
            obj.schoolid=paymentarr[i].school_id;
            obj.academicyear=paymentarr[i].academic_year;
            obj.admissionno=paymentarr[i].admission_no;
            obj.studentname=paymentarr[i].student_name;
            obj.grade=paymentarr[i].grade;
            if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null)
            {
            paymentarr[i].latefee_amount=0;
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=true;
            } 
            else{
            if(paymentarr[i].latefee_paymentmode=="Cash"){
            obj.hidelatefeecashparticular=false;
            obj.hidelatefeechequeparticular=true;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;
            }
            else{
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=false;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latebankname=paymentarr[i].latefee_bankname;
            obj.laterefno=paymentarr[i].latefee_refno;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;   
            }
            }
            obj.fineamount=paymentarr[i].fine_amount;
            // obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.installment=paymentarr[i].installment;
            obj.receiptdate=paymentarr[i].receipt_date;
            obj.receiptno=paymentarr[i].receipt_no;
            obj.receipttype="RECEIPT";
            obj.hidecurrreceipt=true;
            obj.hidereceipt=false;
            obj.hideack=true;
            obj.chequeview=true;
            obj.transferview=false;
            obj.hidecashparticular=true;
            obj.hidechequeparticular=true;
            obj.hidetransferparticular=false;
            obj.hidesplit=true;
            transfertotal=parseFloat(parseFloat(paymentarr[i].installment_amount)+parseFloat(transfertotal)+parseFloat(paymentarr[i].fine_amount)).toFixed(2);
            transferparticular.push({"slno":transferno,"installment":paymentarr[i].installment_type,"bankname":paymentarr[i].bank_name,"referenceno":paymentarr[i].reference_no,"receiveddate":paymentarr[i].received_date,"installmentamount":paymentarr[i].installment_amount,"feetype":paymentarr[i].fees});
            for(var j=i+1;j<paymentarr.length;j++){
              if(paymentarr[i].receipt_no==paymentarr[j].receipt_no){
              paymentarr[j].flag=1;
              transferno++;
              if(paymentarr[j].fine_amount==""||paymentarr[j].fine_amount==null)
            paymentarr[j].fine_amount=0;
            if(paymentarr[j].latefee_amount==""||paymentarr[j].latefee_amount==null)
            paymentarr[j].latefee_amount=0;
              transfertotal=parseFloat(parseFloat(paymentarr[j].installment_amount)+parseFloat(transfertotal)+parseFloat(paymentarr[j].fine_amount)).toFixed(2);
              transferparticular.push({"slno":transferno,"installment":paymentarr[j].installment_type,"bankname":paymentarr[j].bank_name,"referenceno":paymentarr[j].reference_no,"receiveddate":paymentarr[j].received_date,"installmentamount":paymentarr[j].installment_amount,"feetype":paymentarr[j].fees});             
              // paymentarr.splice(j,1);  
              }
            }
            // transferno++;
            // paymentarr.splice(i,1);  
            obj.totalfees=transfertotal;
            obj.paymentarr=transferparticular;
            feereceiptarr.push(obj);
          }
        }

        // alert(JSON.stringify(paymentarr));
        // alert(JSON.stringify(feereceiptarr)); 
        this.callFeeReceipt();
      },
      fetchstudfeesplitupService:function(){
        this.fetchstudfeesplitupurl=sessionStorage.getItem("addrinfo")+"/fetchstudfeesplitup-service";
        var obj={"schoolid":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.admissionno=localStorage.getItem("curr_sess_enquiryno");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        // obj.feecode=feecode;
        this.fetchstudfeesplitupparam=obj;     
        this.$.fetchstudfeesplitupajax.generateRequest();
      },
      fetchstudfeesplitupResponse:function(e){
        splituparr=e.detail.response.returnval;
        // alert(JSON.stringify(splituparr));
        if(splituparr.length>0)
        {
        this.FnProcessReceipt();
        }
      },
      fetchsplitupService:function(feecode){
        this.fetchsplitupurl=sessionStorage.getItem("addrinfo")+"/fetchsplitup-service";
        var obj={"schoolid":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.feecode=feecode;
        this.fetchsplitupparam=obj;     
        this.$.fetchsplitupajax.generateRequest();
      },
      fetchsplitupResponse:function(e){
        splituparr=e.detail.response.returnval;
        // alert(JSON.stringify(splituparr));
        if(splituparr.length>0)
        {
        this.FnProcessReceipt();
        }
      },
      FnProcessReceipt:function(){
        var split=[];
        var a=[];
        // alert(JSON.stringify(splituparr));
        for(var i=0;i<splituparr.length;i++)
        {       
        var nameobj={"installment":"","installmentamount":""};
        nameobj.installment=splituparr[i].installment; 
        var amt=0;
        var actamt=0;
        var obj={"feetype":"","amount":""};
        obj.feetype=splituparr[i].feetype;
        obj.feetypeamount=splituparr[i].feetype_amount;
        a.push(obj);
        for(var j=i+1;j<splituparr.length;j++)
        {
           // alert(termarr[i].insno+" "+termarr[j].insno);
           if(splituparr[i].installment==splituparr[j].installment)
           {
             var obj1={"feetype":"","amount":""}
             obj1.feetype=splituparr[j].feetype;
             obj1.feetypeamount=splituparr[j].feetype_amount;
             if(splituparr[j].feetype_amount>0)
             a.push(obj1);
             splituparr.splice(j,1);
             j--;
           }
        }
        nameobj.fees=a;
        split.push(nameobj);
        a=[];        
       }
        
       // alert(JSON.stringify(split));
        // var commitfee='';
        // var termfee='';
        // for(var i=0;i<splituparr.length;i++){
        //   if(splituparr[i].base_fee_type=="Commitmentfee")
        //     commitfee=commitfee+splituparr[i].fee_type+',';
        //   if(splituparr[i].base_fee_type=="Termfee")
        //     termfee=termfee+splituparr[i].fee_type+',';
        // }

        for(var i=0;i<paymentarr.length;i++){
          paymentarr[i].flag=0;
          for(var j=0;j<split.length;j++){
          if(paymentarr[i].installment==split[j].installment)
            paymentarr[i].fees=split[j].fees;
         }
        }
       
        for(var i=0;i<paymentarr.length;i++){
        var cashparticular=[];
        var chequeparticular=[];
        var transferparticular=[];
        var tpparticular=[];
        var cashtotal=0;
        var chequetotal=0;
        var transfertotal=0; 
        var tptotal=0; 
        var cashno=1;
        var chequeno=1;
        var transferno=1;       
        var tpno=1; 
        var cashcnt=0;
        var chequecnt=0;
        var transfercnt=0;
        var tpcnt=0;
          if(paymentarr[i].mode_of_payment=="Cash"&&paymentarr[i].flag==0)
          {
            paymentarr[i].flag=1;
            var obj={"schoolid":"","academicyear":"","admissionno":"","studentname":"","grade":"","installment":"","paiddate":"","receiptno":"","receipttype":"","hidereceipt":"","hideack":"","chequeview":"","transferview":"","paymentarr":""};
            obj.modeofpayment=paymentarr[i].mode_of_payment;
            obj.schoolid=paymentarr[i].school_id;
            obj.academicyear=paymentarr[i].academic_year;
            obj.admissionno=paymentarr[i].admission_no;
            obj.studentname=paymentarr[i].student_name;
            obj.grade=paymentarr[i].grade;
            if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null){
            paymentarr[i].latefee_amount=0;
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=true;
            } 
            else{
            if(paymentarr[i].latefee_paymentmode=="Cash"){
            obj.hidelatefeecashparticular=false;
            obj.hidelatefeechequeparticular=true;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;
            }
            else{
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=false;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latebankname=paymentarr[i].latefee_bankname;
            obj.laterefno=paymentarr[i].latefee_refno;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;   
            }
            }
            obj.fineamount=paymentarr[i].fine_amount;
            // obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.installment=paymentarr[i].installment;
            obj.receiptdate=paymentarr[i].receipt_date;
            obj.receiptno=paymentarr[i].receipt_no;
            obj.receipttype="RECEIPT";
            obj.hidecurrreceipt=true;
            obj.hidereceipt=false;
            obj.hideack=true;
            obj.chequeview=true;
            obj.transferview=true;
            obj.hidecashparticular=false;
            obj.hidechequeparticular=true;
            obj.hidetransferparticular=true;
            
            cashtotal=parseFloat(parseFloat(paymentarr[i].installment_amount)+parseFloat(cashtotal)+parseFloat(paymentarr[i].fine_amount)).toFixed(2);
            cashparticular.push({"slno":cashno,"installment":paymentarr[i].installment_type,"installmentamount":paymentarr[i].installment_amount,"feetype":paymentarr[i].fees});
            for(var j=i+1;j<paymentarr.length;j++){

              if(paymentarr[i].receipt_no==paymentarr[j].receipt_no){
              paymentarr[j].flag=1;
              cashno++;
              if(paymentarr[j].fine_amount==""||paymentarr[j].fine_amount==null)
            paymentarr[j].fine_amount=0;
            if(paymentarr[j].latefee_amount==""||paymentarr[j].latefee_amount==null)
            paymentarr[j].latefee_amount=0;
              cashtotal=parseFloat(parseFloat(paymentarr[j].installment_amount)+parseFloat(cashtotal)+parseFloat(paymentarr[j].fine_amount)).toFixed(2);
              cashparticular.push({"slno":cashno,"installment":paymentarr[j].installment_type,"installmentamount":paymentarr[j].installment_amount,"feetype":paymentarr[j].fees});
              // paymentarr.splice(j,1);             
              }
            }

            obj.totalfees=cashtotal;
            obj.paymentarr=cashparticular;
            // cashno=1;
            // cashtotal=0;
            // paymentarr.splice(i,1);
            feereceiptarr.push(obj);
          }
          if(paymentarr[i].mode_of_payment=="Third Party"&&paymentarr[i].flag==0)
          {
            paymentarr[i].flag=1;
            var obj={"schoolid":"","academicyear":"","admissionno":"","studentname":"","grade":"","installment":"","paiddate":"","receiptno":"","receipttype":"","hidereceipt":"","hideack":"","chequeview":"","transferview":"","paymentarr":""};
            obj.modeofpayment=paymentarr[i].mode_of_payment;
            obj.schoolid=paymentarr[i].school_id;
            obj.academicyear=paymentarr[i].academic_year;
            obj.admissionno=paymentarr[i].admission_no;
            obj.studentname=paymentarr[i].student_name;
            obj.grade=paymentarr[i].grade;
            if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null){
            paymentarr[i].latefee_amount=0;
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=true;
            } 
            else{
            if(paymentarr[i].latefee_paymentmode=="Cash"){
            obj.hidelatefeecashparticular=false;
            obj.hidelatefeechequeparticular=true;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;
            }
            else{
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=false;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latebankname=paymentarr[i].latefee_bankname;
            obj.laterefno=paymentarr[i].latefee_refno;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;   
            }
            }
            obj.fineamount=paymentarr[i].fine_amount;
            // obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.installment=paymentarr[i].installment;
            obj.receiptdate=paymentarr[i].receipt_date;
            obj.receiptno=paymentarr[i].receipt_no;
            obj.receipttype="RECEIPT";
            obj.hidecurrreceipt=true;
            obj.hidereceipt=false;
            obj.hideack=true;
            obj.chequeview=true;
            obj.transferview=true;
            obj.hidecashparticular=false;
            obj.hidechequeparticular=true;
            obj.hidetransferparticular=true;

            tptotal=parseFloat(parseFloat(paymentarr[i].installment_amount)+parseFloat(cashtotal)+parseFloat(paymentarr[i].fine_amount)).toFixed(2);
            tpparticular.push({"slno":tpno,"installment":paymentarr[i].installment_type,"installmentamount":paymentarr[i].installment_amount,"feetype":paymentarr[i].fees});
            for(var j=i+1;j<paymentarr.length;j++){

              if(paymentarr[i].receipt_no==paymentarr[j].receipt_no){
              paymentarr[j].flag=1;
              tpno++;
              if(paymentarr[j].fine_amount==""||paymentarr[j].fine_amount==null)
            paymentarr[j].fine_amount=0;
            if(paymentarr[j].latefee_amount==""||paymentarr[j].latefee_amount==null)
            paymentarr[j].latefee_amount=0;
              tptotal=parseFloat(parseFloat(paymentarr[j].installment_amount)+parseFloat(tptotal)+parseFloat(paymentarr[i].fine_amount)).toFixed(2);
              tpparticular.push({"slno":tpno,"installment":paymentarr[j].installment_type,"installmentamount":paymentarr[j].installment_amount,"feetype":paymentarr[j].fees});
              // paymentarr.splice(j,1);             
              }
            }

            obj.totalfees=tptotal;
            obj.paymentarr=tpparticular;
            // cashno=1;
            // cashtotal=0;
            // paymentarr.splice(i,1);
            feereceiptarr.push(obj);
          }
          if(paymentarr[i].mode_of_payment=="Cheque"&&paymentarr[i].paid_status=="cleared"&&paymentarr[i].flag==0)
          {
            paymentarr[i].flag=1;
            var obj={"schoolid":"","academicyear":"","admissionno":"","studentname":"","grade":"","installment":"","paiddate":"","receiptno":"","receipttype":"","hidereceipt":"","hideack":"","chequeview":"","transferview":"","paymentarr":""};
            obj.modeofpayment=paymentarr[i].mode_of_payment;
            obj.schoolid=paymentarr[i].school_id;
            obj.academicyear=paymentarr[i].academic_year;
            obj.admissionno=paymentarr[i].admission_no;
            obj.studentname=paymentarr[i].student_name;
            obj.grade=paymentarr[i].grade;
            if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null)
            {
            paymentarr[i].latefee_amount=0;
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=true;
            } 
            else{
            if(paymentarr[i].latefee_paymentmode=="Cash"){
            obj.hidelatefeecashparticular=false;
            obj.hidelatefeechequeparticular=true;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;
            }
            else{
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=false;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latebankname=paymentarr[i].latefee_bankname;
            obj.laterefno=paymentarr[i].latefee_refno;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;   
            }
            }
            obj.fineamount=paymentarr[i].fine_amount;
            // obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.installment=paymentarr[i].installment;
            obj.receiptdate=paymentarr[i].receipt_date;
            obj.receiptno=paymentarr[i].receipt_no;
            obj.receipttype="RECEIPT";
            obj.hidecurrreceipt=true;
            obj.hidereceipt=false;
            obj.hideack=true;
            obj.chequeview=false;
            obj.transferview=true;
            obj.hidecashparticular=true;
            obj.hidechequeparticular=false;
            obj.hidetransferparticular=true;

            chequetotal=parseFloat(parseFloat(paymentarr[i].installment_amount)+parseFloat(chequetotal)+parseFloat(paymentarr[i].fine_amount)).toFixed(2);
            chequeparticular.push({"slno":chequeno,"installment":paymentarr[i].installment_type,"bankname":paymentarr[i].bank_name,"chequeno":paymentarr[i].cheque_no,"chequedate":paymentarr[i].installment_date,"installmentamount":paymentarr[i].installment_amount,"feetype":paymentarr[i].fees});
            for(var j=i+1;j<paymentarr.length;j++){
              if(paymentarr[i].receipt_no==paymentarr[j].receipt_no){
              paymentarr[j].flag=1;
              chequeno++;
              if(paymentarr[j].fine_amount==""||paymentarr[j].fine_amount==null)
            paymentarr[j].fine_amount=0;
            if(paymentarr[j].latefee_amount==""||paymentarr[j].latefee_amount==null)
            paymentarr[j].latefee_amount=0;
            
              chequetotal=parseFloat(parseFloat(paymentarr[j].installment_amount)+parseFloat(chequetotal)+parseFloat(paymentarr[j].fine_amount)).toFixed(2);
              chequeparticular.push({"slno":chequeno,"installment":paymentarr[j].installment_type,"bankname":paymentarr[j].bank_name,"chequeno":paymentarr[j].cheque_no,"chequedate":paymentarr[j].installment_date,"installmentamount":paymentarr[j].installment_amount,"feetype":paymentarr[j].fees});              
              // paymentarr.splice(j,1);  
              }              
            }
            // paymentarr.splice(i,1);  
            // chequeno++;
            obj.totalfees=chequetotal;
            obj.paymentarr=chequeparticular;
            feereceiptarr.push(obj);
          }
          if(paymentarr[i].mode_of_payment=="Cheque"&&paymentarr[i].paid_status=="inprogress"&&paymentarr[i].flag==0)
          {
            var obj={"schoolid":"","academicyear":"","admissionno":"","studentname":"","grade":"","installment":"","paiddate":"","receiptno":"","receipttype":"","hidereceipt":"","hideack":"","chequeview":"","transferview":"","paymentarr":""};
            obj.modeofpayment=paymentarr[i].mode_of_payment;
            obj.schoolid=paymentarr[i].school_id;
            obj.academicyear=paymentarr[i].academic_year;
            obj.admissionno=paymentarr[i].admission_no;
            obj.studentname=paymentarr[i].student_name;
            obj.grade=paymentarr[i].grade;
            if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null)
            {
            paymentarr[i].latefee_amount=0;
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=true;
            } 
            else{
            if(paymentarr[i].latefee_paymentmode=="Cash"){
            obj.hidelatefeecashparticular=false;
            obj.hidelatefeechequeparticular=true;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;
            }
            else{
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=false;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latebankname=paymentarr[i].latefee_bankname;
            obj.laterefno=paymentarr[i].latefee_refno;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;   
            }
            }
            obj.fineamount=paymentarr[i].fine_amount;
            // obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.installment=paymentarr[i].installment;
            obj.receiptdate=paymentarr[i].receipt_date;
            obj.ackno=paymentarr[i].receipt_no;
            obj.receipttype="ACKNOWLEDGEMENT";
            obj.hidecurrreceipt=true;
            obj.hidereceipt=true;
            obj.hideack=false;
            obj.chequeview=false;
            obj.transferview=true;
            obj.hidecashparticular=true;
            obj.hidechequeparticular=false;
            obj.hidetransferparticular=true;
            
            chequetotal=parseFloat(parseFloat(paymentarr[i].installment_amount)+parseFloat(chequetotal)+parseFloat(paymentarr[i].fine_amount)).toFixed(2);
            chequeparticular.push({"slno":chequeno,"installment":paymentarr[i].installment_type,"bankname":paymentarr[i].bank_name,"chequeno":paymentarr[i].cheque_no,"chequedate":paymentarr[i].installment_date,"installmentamount":paymentarr[i].installment_amount,"feetype":paymentarr[i].fees});
            for(var j=i+1;j<paymentarr.length;j++){
              if(paymentarr[i].receipt_no==paymentarr[j].receipt_no){
              paymentarr[j].flag=1;
              chequeno++;
              if(paymentarr[j].fine_amount==""||paymentarr[j].fine_amount==null)
            paymentarr[j].fine_amount=0;
            if(paymentarr[j].latefee_amount==""||paymentarr[j].latefee_amount==null)
            paymentarr[j].latefee_amount=0;
           
              chequetotal=parseFloat(parseFloat(paymentarr[j].installment_amount)+parseFloat(chequetotal)+parseFloat(paymentarr[j].fine_amount)).toFixed(2);
              chequeparticular.push({"slno":chequeno,"installment":paymentarr[j].installment_type,"bankname":paymentarr[j].bank_name,"chequeno":paymentarr[j].cheque_no,"chequedate":paymentarr[j].installment_date,"installmentamount":paymentarr[j].installment_amount,"feetype":paymentarr[j].fees});             
              // paymentarr.splice(j,1);  
              }
            }
            // chequeno++;
            // paymentarr.splice(i,1);  
            obj.totalfees=chequetotal;
            obj.paymentarr=chequeparticular;
            feereceiptarr.push(obj);
          }

          if((paymentarr[i].mode_of_payment=="Transfer"||paymentarr[i].mode_of_payment=="Card Swipe")&&paymentarr[i].flag==0)
          {
            var obj={"schoolid":"","academicyear":"","admissionno":"","studentname":"","grade":"","installment":"","paiddate":"","receiptno":"","receipttype":"","hidereceipt":"","hideack":"","chequeview":"","transferview":"","paymentarr":""};
            obj.modeofpayment=paymentarr[i].mode_of_payment;
            obj.schoolid=paymentarr[i].school_id;
            obj.academicyear=paymentarr[i].academic_year;
            obj.admissionno=paymentarr[i].admission_no;
            obj.studentname=paymentarr[i].student_name;
            obj.grade=paymentarr[i].grade;
            if(paymentarr[i].fine_amount==""||paymentarr[i].fine_amount==null)
            paymentarr[i].fine_amount=0;
            if(paymentarr[i].latefee_amount==""||paymentarr[i].latefee_amount==null)
            {
            paymentarr[i].latefee_amount=0;
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=true;
            } 
            else{
            if(paymentarr[i].latefee_paymentmode=="Cash"){
            obj.hidelatefeecashparticular=false;
            obj.hidelatefeechequeparticular=true;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;
            }
            else{
            obj.hidelatefeecashparticular=true;
            obj.hidelatefeechequeparticular=false;            
            obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.latebankname=paymentarr[i].latefee_bankname;
            obj.laterefno=paymentarr[i].latefee_refno;
            obj.latefeepaymentmode=paymentarr[i].latefee_paymentmode;   
            }
            }
            obj.fineamount=paymentarr[i].fine_amount;
            // obj.latefeeamount=paymentarr[i].latefee_amount;
            obj.installment=paymentarr[i].installment;
            obj.receiptdate=paymentarr[i].receipt_date;
            obj.receiptno=paymentarr[i].receipt_no;
            obj.receipttype="RECEIPT";
            obj.hidecurrreceipt=true;
            obj.hidereceipt=false;
            obj.hideack=true;
            obj.chequeview=true;
            obj.transferview=false;
            obj.hidecashparticular=true;
            obj.hidechequeparticular=true;
            obj.hidetransferparticular=false;

            transfertotal=parseFloat(parseFloat(paymentarr[i].installment_amount)+parseFloat(transfertotal)+parseFloat(paymentarr[i].fine_amount)).toFixed(2);
            transferparticular.push({"slno":transferno,"installment":paymentarr[i].installment_type,"bankname":paymentarr[i].bank_name,"referenceno":paymentarr[i].reference_no,"receiveddate":paymentarr[i].received_date,"installmentamount":paymentarr[i].installment_amount,"feetype":paymentarr[i].fees});
            for(var j=i+1;j<paymentarr.length;j++){
              if(paymentarr[i].receipt_no==paymentarr[j].receipt_no){
              paymentarr[j].flag=1;
              transferno++;
              if(paymentarr[j].fine_amount==""||paymentarr[j].fine_amount==null)
            paymentarr[j].fine_amount=0;
            if(paymentarr[j].latefee_amount==""||paymentarr[j].latefee_amount==null)
            paymentarr[j].latefee_amount=0;
            
              transfertotal=parseFloat(parseFloat(paymentarr[j].installment_amount)+parseFloat(transfertotal)+parseFloat(paymentarr[j].fine_amount)).toFixed(2);
              transferparticular.push({"slno":transferno,"installment":paymentarr[j].installment_type,"bankname":paymentarr[j].bank_name,"referenceno":paymentarr[j].reference_no,"receiveddate":paymentarr[j].received_date,"installmentamount":paymentarr[j].installment_amount,"feetype":paymentarr[j].fees});             
              // paymentarr.splice(j,1);  
              }
            }
            // transferno++;
            // paymentarr.splice(i,1);  
            obj.totalfees=transfertotal;
            obj.paymentarr=transferparticular;
            feereceiptarr.push(obj);
          }
        }

        // alert(JSON.stringify(paymentarr));
        // alert(JSON.stringify(feereceiptarr)); 
        this.callFeeReceipt();
      },
      callFeeReceipt:function(){
        // alert('Fee paid!!');
        // alert('calling receipt');
        // alert(JSON.stringify(paymentarr));
        document.querySelector('searchreceipt-card').FnRefresh();
        document.querySelector('feereceipt-outcard').paymentreceiptarr=feereceiptarr;
           paymentarr=[];
           splituparr=[];
           feereceiptarr=[];
        // document.querySelector('feereceipt-outcard').paymentreceiptarr=paymentarr;
        // document.querySelector('CRM-app').setPage('feereceipt-outcard');
        document.querySelector('CRM-app').setPage('feereceipt-outcard');
        // window.open('../elements/receiptindex.html', '_blank');
        // paymentarr=[];
        // // paymentlength=0;
        // // paymentcount=0;
        // feereceiptarr=[];
        // feecashcount=0;
        // feechequecount=0;
        // feetransfercount=0;
        // arr=[];
      },
      processbouncechequeService:function(searchvalue){
        this.processbouncechequeurl=sessionStorage.getItem("addrinfo")+"/processbouncecheque-service";
        var obj={"schoolid":""};
        obj.searchvalue=searchvalue;
        obj.schoolid=localStorage.getItem("schoolid");
        this.processbouncechequeparam=obj;
        this.$.processbouncechequeajax.generateRequest();
      },
      processbouncechequeResponse:function(e){
        var arr=e.detail.response.returnval;
        if(arr!='no rows'){
        if(arr.length>0){
          for(var i=0;i<arr.length;i++){
            arr[i].sno=parseInt(i)+1;
            arr[i].flag=0;
          }
        document.querySelector('chequebounceorcancel-card').chequearr=arr;
        document.querySelector('chequebounceorcancel-card').FnSetChequeArray(arr);
        }
        }
        else{
            arr=[];
        document.querySelector('chequebounceorcancel-card').chequearr=arr;
        document.querySelector('chequebounceorcancel-card').FnSetChequeArray(arr);  
        }
      },
      fetchchequeforeditordelete:function(searchvalue){
        this.fetchchequeforeditordeleteurl=sessionStorage.getItem("addrinfo")+"/fetchchequeforeditordelete-service";
        var obj={"schoolid":""};
        obj.searchvalue=searchvalue;
        obj.schoolid=localStorage.getItem("schoolid");
        this.fetchchequeforeditordeleteparam=obj;
        this.$.fetchchequeforeditordeleteajax.generateRequest();
      },
      fetchchequeforeditordeleteResponse:function(e){
        var arr=e.detail.response.returnval;
        if(arr.length>0){
          for(var i=0;i<arr.length;i++){
            arr[i].sno=parseInt(i)+1;
            arr[i].flag=0;
          }
        document.querySelector('editdelete-cheques-card').chequearr=arr;
        document.querySelector('editdelete-cheques-card').FnSetChequeArray(arr);
        }
        else{
            arr=[];
           document.querySelector('editdelete-cheques-card').chequearr=arr;
        document.querySelector('editdelete-cheques-card').FnSetChequeArray(arr); 
        }
      },
      editchequeService:function(enrno,chequeno,bankname,chequedate,installmentamount,paiddate,installmenttype){
        this.editchequeurl=sessionStorage.getItem("addrinfo")+"/editcheque-service";
        var obj={"schoolid":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.admissionno=enrno;
        obj.chequeno=chequeno;
        obj.bankname=bankname;
        obj.chequedate=localStorage.getItem("curr_sess_chequedate");
        obj.amount=installmentamount;
        obj.installment=installmenttype;
        this.editchequeparam=obj;
        this.$.editchequeajax.generateRequest();
      },
      editchequeResponse:function(e){
        alert(e.detail.response.returnval);
        this.fetchchequeforeditordelete(localStorage.getItem("curr_sess_enquiryno"));
      },
      deletechequeService:function(enrno,chequeno,bankname,chequedate,installmentamount,paiddate){
        this.deletechequeurl=sessionStorage.getItem("addrinfo")+"/deletecheque-service";
        var obj={"schoolid":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.admissionno=enrno;
        obj.chequeno=chequeno;
        obj.bankname=bankname;
        obj.chequedate=localStorage.getItem("curr_sess_chequedate");
        obj.amount=installmentamount;
        this.deletechequeparam=obj;
        this.$.deletechequeajax.generateRequest();
      },
      deletechequeResponse:function(e){
        alert(e.detail.response.returnval);
        this.fetchchequeforeditordelete(localStorage.getItem("curr_sess_enquiryno"));
      },
      fetchdiscounttypesService:function(){
        this.fetchdiscounttypesurl=sessionStorage.getItem("addrinfo")+"/fetchdiscounttypes-service";
        var obj={"schoolid":""};
        obj.schoolid=localStorage.getItem("schoolid");
        this.fetchdiscounttypesparam=obj;
        this.$.fetchdiscounttypesajax.generateRequest();
      },
      fetchdiscounttypesResponse:function(e){
        var arr=e.detail.response.returnval;
        document.querySelector('attachdiscount-card').discountarr=arr;
      },
      fetchstudenttoattachdiscountService:function(admissionno){
        this.fetchstudenttoattachdiscounturl=sessionStorage.getItem("addrinfo")+"/fetchstudenttoattachdiscount-service";
        var obj={"schoolid":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.admissionno=admissionno;
        this.fetchstudenttoattachdiscountparam=obj;
        this.$.fetchstudenttoattachdiscountajax.generateRequest();
      },
      fetchstudenttoattachdiscountResponse:function(e){
        var arr=e.detail.response.returnval;
        document.querySelector('attachdiscount-card').admissionno=arr[0].admission_no;
        document.querySelector('attachdiscount-card').studentname=arr[0].student_name;
        document.querySelector('attachdiscount-card').grade=arr[0].class_for_admission;
        document.querySelector('attachdiscount-card').Fnhidediscountmapcard();
        document.querySelector('adhoc-discount').admissionno=arr[0].admission_no;
        document.querySelector('adhoc-discount').studentname=arr[0].student_name;
        document.querySelector('adhoc-discount').grade=arr[0].class_for_admission;
        document.querySelector('adhoc-discount').Fnhidediscountmapcard();
        document.querySelector('latefee-card').admissionno=arr[0].admission_no;
        document.querySelector('latefee-card').studentname=arr[0].student_name;
        document.querySelector('latefee-card').grade=arr[0].class_for_admission;
        document.querySelector('latefee-card').Fnhidelatefeecard();
        document.querySelector('defaulter-update').admissionno=arr[0].admission_no;
        document.querySelector('defaulter-update').studentname=arr[0].student_name;
        document.querySelector('defaulter-update').grade=arr[0].class_for_admission;
        document.querySelector('defaulter-update').Fnhidediscountmapcard();
      },
      attachdiscountService:function(admissionno,discounttypeid){
        this.attachdiscounturl=sessionStorage.getItem("addrinfo")+"/attachdiscount-service";
        var obj={"schoolid":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.admissionno=admissionno;
        obj.discountid=discounttypeid;
        this.attachdiscountparam=obj;
        this.$.attachdiscountajax.generateRequest();
      },
      attachdiscountResponse:function(e){
        alert(e.detail.response.returnval);
        document.querySelector('attachdiscount-card').FnRefresh();
        document.querySelector('attachdiscount-itemcard').FnRefresh();
      },
      updateadhocdiscountService:function(admissionno,amount,feetype,reason){
        this.updateadhocdiscounturl=sessionStorage.getItem("addrinfo")+"/updateadhocdiscount-service";
        var obj={"schoolid":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.admissionno=admissionno;
        obj.amount=amount;
        obj.feetype=feetype;
        obj.reason=reason;
        this.updateadhocdiscountparam=obj;
        this.$.updateadhocdiscountajax.generateRequest();
      },
      updateadhocdiscountResponse:function(e){
        alert(e.detail.response.returnval);
        document.querySelector('adhoc-discount').FnRefresh();
        document.querySelector('adhoc-discount-itemcard').FnRefresh();
      },
      updatelatefeeService:function(admissionno,amount,reason,installment,paymentmode,refno,bankname){
        this.updatelatefeeurl=sessionStorage.getItem("addrinfo")+"/updatelatefee-service";
        var obj={"schoolid":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.admissionno=admissionno;
        obj.amount=amount;
        obj.reason=reason;
        obj.installment=installment;
        obj.paymentmode=paymentmode;
        obj.refno=refno;
        obj.bankname=bankname;
        var d=new Date();
        var currdate=(d.getMonth()+1)+"/"+d.getDate()+"/"+d.getFullYear();
        obj.latefeedate=currdate;
        this.updatelatefeeparam=obj;
        this.$.updatelatefeeajax.generateRequest();
      },
      updatelatefeeResponse:function(e){
        alert(e.detail.response.returnval);
        document.querySelector('latefee-card').FnRefresh();
        document.querySelector('latefee-itemcard').FnRefresh();
      },
      updatedefaulterService:function(admissionno){
        this.updatedefaulterurl=sessionStorage.getItem("addrinfo")+"/updatedefaulter-service";
        var obj={"schoolid":""};
        obj.schoolid=localStorage.getItem("schoolid");
        // alert(admissionno);
        obj.admissionno=admissionno;
        this.updatedefaulterparam=obj;
        this.$.updatedefaulterajax.generateRequest();
      },
      updatedefaulterResponse:function(e){
        alert(e.detail.response.returnval);
        document.querySelector('defaulter-update').FnRefresh();
        document.querySelector('defaulter-update-itemcard').FnRefresh();
      },
      fetchstudentdeldiscountService:function(admissionno){
        this.fetchstudentdeldiscountServiceurl=sessionStorage.getItem("addrinfo")+"/fetchstudentdeldiscount-service";
        var obj={"schoolid":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.admissionno=admissionno;
        //alert(JSON.stringify(obj));
        this.fetchstudentdeldiscountServiceparam=obj;
        this.$.fetchstudentdeldiscountServiceajax.generateRequest();
      },
      fetchstudentdeldiscountResponse:function(e)
      {
        var arr=e.detail.response.returnval;
        // alert(JSON.stringify(arr));       
        //alert('fetchstudentdeldiscountResponse...............');
        // alert(JSON.stringify(e.detail.response.returnval));  
        document.querySelector('deletediscount-card').admissionno=arr[0].admission_no;
        document.querySelector('deletediscount-card').studentname=arr[0].student_name;
        document.querySelector('deletediscount-card').grade=arr[0].class_for_admission;
        document.querySelector('deletediscount-card').discounttype=arr[0].discounttypename;
        document.querySelector('deletediscount-card').Fnhidedeldiscountcard();
        
      },
     
       deltediscountService:function(admissionno,discounttype)
       {
        this.deltediscounturl=sessionStorage.getItem("addrinfo")+"/deltediscount-service";
        var obj={"schoolid":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.admissionno=admissionno;
        obj.discounttype=discounttype;
        this.deltediscountparam=obj;
        // alert(JSON.stringify(obj));
        this.$.deltediscountajax.generateRequest();
      },
      deltediscountResponse:function(e)
      {
        var arr=e.detail.response.returnval;
        if(arr="Done")
        {
            alert("Deleted");
            document.querySelector('deletediscount-card').FnRefresh();
            document.querySelector('deletediscount-item-card').FnRefresh();
        }
        
      }
    });
  })();
  </script>
</dom-module>
