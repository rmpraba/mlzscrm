
<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="transport-processing-service">
  <template>
    <iron-ajax
        method="post"
        id="fetchalltransportstudentajax"
        url="{{fetchalltransportstudenturl}}"
        params="{{fetchalltransportstudentparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchalltransportstudentResponse"
        debounce-duration="300"
        >
    <iron-ajax
        method="post"
        id="processtransportbouncechequeajax"
        url="{{processtransportbouncechequeurl}}"
        params="{{processtransportbouncechequeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="processtransportbouncechequeResponse"
        debounce-duration="300"
        >
    
  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'transport-processing-service',
      fetchalltransportstudentService:function(){
        this.fetchalltransportstudenturl=sessionStorage.getItem("addrinfo")+"/fetchalltransportstudent-service";
        var obj={"schoolid":"","prefixid":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        this.fetchalltransportstudentparam=obj;
        this.$.fetchalltransportstudentajax.generateRequest();
      },
      fetchalltransportstudentResponse:function(e){
        var arr=e.detail.response.returnval;
        document.querySelector('transport-cheque-bouncecancel').autocompletearr(arr);
      },
      processtransportbouncechequeService:function(studentid){
        // alert(studentid);
        this.processtransportbouncechequeurl=sessionStorage.getItem("addrinfo")+"/processtransportbouncecheque-servicee";
        var obj={"schoolid":"","academicyear":"","id":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.id=studentid;
        // alert(JSON.stringify(obj));
        this.processtransportbouncechequeparam=obj;
        this.$.processtransportbouncechequeajax.generateRequest();
      },
      processtransportbouncechequeResponse:function(e){
        var arr=e.detail.response.returnval;
        // alert(JSON.stringify(arr));
        var temparr=[];
        var t=1;
        for(var i=0;i<arr.length;i++){          
          if(arr[i].installtype="Installment1"&&arr[i].installment_1!=""&&arr[i].installment_1>0){
            var obj={};
            obj.sno=t;
            obj.student_id=arr[i].student_id;
            obj.student_name=arr[i].name;
            obj.installtype=arr[i].installtype;
            obj.cheque_no=arr[i].cheque_no;
            obj.bank_name=arr[i].bank_name;
            obj.cheque_date=arr[i].cheque_date;
            obj.installment_amount=arr[i].installment_1;
            temparr.push(obj);
            t=t+1;
          }
          if(arr[i].installtype="Installment2"&&arr[i].installment_2!=""&&arr[i].installment_2>0){
            var obj={};
            obj.sno=t;
            obj.student_id=arr[i].student_id;
            obj.student_name=arr[i].name;
            obj.installtype=arr[i].installtype;
            obj.cheque_no=arr[i].cheque_no;
            obj.bank_name=arr[i].bank_name;
            obj.cheque_date=arr[i].cheque_date;
            obj.installment_amount=arr[i].installment_2;
            temparr.push(obj);
            t=t+1;
          }
        }
        document.querySelector('transport-cheque-bouncecancel').chequearr=temparr;
      }
    });
  })();
  </script>
</dom-module>
